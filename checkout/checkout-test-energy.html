<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Step Checkout - Mit Consent</title>
  <!-- Verivox Design System CSS -->
  <link rel="stylesheet" href="https://js.vxcdn.com/vx/ds-components/7/ds-components.css" />
  <!-- Verivox Design System Components -->
  <script type="module" src="https://js.vxcdn.com/vx/ds-components/7/ds-components.esm.js"></script>
  <!-- Verivox Icons -->
  <link rel="preload" href="https://js.vxcdn.com/vx/icons/7/VerivoxIcons.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://js.vxcdn.com/vx/icons/7/vx-icons.css" />
  <!-- Verivox DS Tokens (CSS Custom Properties) -->
  <link rel="stylesheet" href="https://js.vxcdn.com/vx/ds-tokens/4/tokens.css" />
  <link rel="stylesheet" href="https://js.vxcdn.com/vx/ds-tokens/latest/ds-typography.css" />
  <!-- Verivox Selawik Font  -->
<link rel="preload" href="https://static.verivox.de/assets/fonts/de/selawik-100.woff" as="font" crossorigin="anonymous">
<link rel="preload" href="https://static.verivox.de/assets/fonts/de/selawik-400.woff" as="font" crossorigin="anonymous">
<link rel="preload" href="https://static.verivox.de/assets/fonts/de/selawik-700.woff" as="font" crossorigin="anonymous">
<style>
    @font-face{font-family:Selawik;src:url(https://static.verivox.de/assets/fonts/de/selawik-400.woff) format("woff"),url(https://static.verivox.de/assets/fonts/de/selawik-400.woff2) format("woff2");font-weight:400;font-style:normal;font-display:optional}
    @font-face{font-family:Selawik;src:url(https://static.verivox.de/assets/fonts/de/selawik-100.woff) format("woff"),url(https://static.verivox.de/assets/fonts/de/selawik-100.woff2) format("woff2");font-weight:100;font-style:normal;font-display:optional}
    @font-face{font-family:Selawik;src:url(https://static.verivox.de/assets/fonts/de/selawik-700.woff) format("woff"),url(https://static.verivox.de/assets/fonts/de/selawik-700.woff2) format("woff2");font-weight:700;font-style:normal;font-display:optional}
</style>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Selawik, Segoe UI, Segoe, Open Sans, Calibri, Tahoma, Geneva, sans-serif;
      font-weight: var(--ds-font-weight-m, 400);
      /*background-color: var(--ds-background-neutral-light);*/
      background-color: var(--ds-background-white);
      padding-top: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main {
      flex: 1;
    }
    /* ===== STICKY HEADER ===== */
    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background-color: var(--ds-background-white);
      border-bottom: 1px solid var(--ds-border-neutral-light);
    }
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: var(--ds-grid-size-fivefold);
      padding: 10px var(--ds-spacing-l);
      margin: 0 10px;
      /*border-bottom: 1px solid var(--ds-border-neutral-regular);*/
    }
    .header-logo {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-s);
      text-decoration: none;
      color: var(--ds-font-text-neutral-regular);
      height: 100%;
    }
    .header-logo img {
      height: 100%;
      width: auto;
      object-fit: contain;
    }
    .header-contact {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-l);
      text-align: right;
    }
    .header-phone {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      font-size: 13px;
      color: var(--ds-font-text-neutral-regular);
    }
    .header-phone .icn {
      font-size: 16px;
      color: var(--ds-font-text-brand-regular);
    }
    .header-hours {
      font-size: 11px;
      color: var(--ds-font-text-neutral-muted);
      line-height: 1.3;
    }
    .header-hours strong {
      display: block;
      font-weight: 600;
      color: var(--ds-font-text-neutral-regular);
    }
    /* ===== DS-STEPS PROGRESS WRAPPER ===== */
    .progress-wrapper {
      padding: 0  var(--ds-spacing-l) var(--ds-spacing-xxxs) var(--ds-spacing-l);
      margin: 0 10px;
      background-color: white;
      border-bottom: 1px solid var(--ds-border-neutral-light);
    }
    ds-steps {
      --ds-steps-gap: var(--ds-spacing-m);
    }
    .ds-steps {
        margin: 1em auto;
    }
    /* ===== STORAGE INFO ===== */
    .storage-info {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      font-size: 11px;
      color: var(--ds-font-text-neutral-muted);
      padding: var(--ds-spacing-xxxs) var(--ds-spacing-l);
      background-color: var(--ds-background-neutral-light);
      border-top: 1px solid var(--ds-border-neutral-light);
    }
    .storage-info .icn {
      font-size: 12px;
    }
    .storage-info button {
      background: none;
      border: none;
      color: var(--ds-font-text-brand-regular);
      cursor: pointer;
      padding: 0;
      font-size: 11px;
      text-decoration: underline;
      font-family: inherit;
      transition: opacity 0.2s ease;
    }
    .storage-info button:hover {
      opacity: 0.8;
    }
   /* ===== CHECKOUT INTRO MIT ILLUSTRATION ===== */
.checkout-intro {
  max-width: 980px;
  margin: 0 auto var(--ds-spacing-l) auto;
}

.intro-header {
  display: flex;
  align-items: flex-start;
  gap: var(--ds-spacing-xs);
}

.intro-illustration {
  width: 100px;
  height: 100px;
  object-fit: contain;
  flex-shrink: 0;
  animation: slideInDown 0.5s ease-out;
}

.intro-text {
  flex: 1;
  color: var(--ds-font-text-neutral-regular);
  line-height: 2rem;
}

.intro-text h1 {
  margin: var(--ds-spacing-xxs) 0 var(--ds-spacing-xs) 0;
  font-size: var(--ds-font-size-xxl);
  font-weight: var(--ds-font-weight-l);
  color: var(--ds-font-headline-neutral-regular);
}

.intro-text p {
  margin: 0;
  font-size: var(--ds-font-size-l);
  color: var(--ds-font-text-neutral-regular);
}

@keyframes slideInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ===== RESPONSIVE MOBILE ===== */
@media (max-width: 768px) {
  .intro-header {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--ds-spacing-m);
  }

  .intro-illustration {
    width: 80px;
    height: 80px;
  }

  .intro-text h1 {
    font-size: var(--ds-font-size-xl);
  }

  .intro-text p {
    font-size: var(--ds-font-size-m);
  }
}
    /* ===== MAIN CONTENT - GRID LAYOUT ===== */
    .main-content {
      padding: var(--ds-spacing-m);
      margin: 0 0 0 0;
    }
    .checkout-wrapper {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: var(--ds-spacing-m);
      max-width: 980px;
      margin: 0 auto;
    }
    .checkout-intro {
      max-width: 980px;
      margin: 0 auto var(--ds-spacing-l) auto;
      color: var(--ds-font-text-neutral-regular);
      line-height: 2rem;
    }
    .checkout-container {
      flex: 1;
    }
    .provider-boxes-wrapper {
      display: flex;
      flex-direction: column;
    }
    .provider-box-item {
      position: sticky;
      top: 200px;
      height: fit-content;
    }
    /* ===== STICKY CHECKOUT FOOTER ===== */

    .sticky-checkout-footer-wrapper {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 500;
        background: var(--ds-background-white);
        border-top: 4px solid var(--ds-border-neutral-regular);
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);


    }
    .sticky-checkout-footer {
        padding: var(--ds-spacing-xs) 0 var(--ds-spacing-m) 0;
        margin: 0 auto;
        max-width: 980px;
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: var(--ds-spacing-m);
        align-items: start;
        animation: slideUp 0.3s ease;

    }
    .sticky-checkout-footer.show {
        display: none;
    }



@keyframes slideUp {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.sticky-footer-content {
  /*display: flex;*/
  align-items: center;
  gap: var(--ds-spacing-m);
}

.sticky-footer-button {
  flex: 1;
  min-height: 48px;
}

.sticky-footer-button ds-button {
  width: 100%;
  min-height: 48px;
}

.sticky-footer-button ds-button[disabled] {
  opacity: 0.5;
  cursor: not-allowed;
}

.sticky-footer-product-wrapper {
  display: grid;
  grid-template-columns: 60px 1fr;
  gap: var(--ds-spacing-xs);
}

.sticky-footer-product {
  display: flex;
  flex-direction: column;
  gap: var(--ds-spacing-xxxs);
  text-align: right;
}

.sticky-footer-provider-name {
  font-size: var(--ds-font-size-m);
  font-weight: var(--ds-font-weight-m);
  color: var(--ds-font-headline-neutral-regular);
}

.sticky-footer-price-amount {
  font-size: var(--ds-font-size-l);
  font-weight: var(--ds-font-weight-l);
  color: var(--ds-font-headline-neutral-regular);
}

.sticky-footer-price-help {
  font-size: var(--ds-font-size-s);
  color: var(--ds-font-text-neutral-regular);
}

/* Adjust main content to avoid overlap */
body {
  padding-bottom: 100px;
}

body.sticky-footer-visible {
  padding-bottom: 120px;
}

/* Mobile */
@media (max-width: 768px) {
    .sticky-checkout-footer{
    grid-template-columns: 1fr;
    gap: var(--ds-spacing-xxs);
    padding: var(--ds-spacing-s) var(--ds-spacing-s) var(--ds-spacing-xxs) var(--ds-spacing-s);
  }

    .sticky-checkout-footer.show {
    grid-template-columns: 1fr;
    gap: var(--ds-spacing-xxs);
    padding: var(--ds-spacing-s) var(--ds-spacing-s) var(--ds-spacing-xxs) var(--ds-spacing-s);
  }

  .sticky-footer-product {
    text-align: right;
  }

  body.sticky-footer-visible {
    padding-bottom: 180px;
  }
}

    /* ===== PROVIDER BOX ===== */
    .provider-box {
      background: var(--ds-background-white);
      border: var(--ds-stroke-m) solid var(--ds-border-neutral-muted);
      border-radius: var(--ds-radius-xl);
      padding: var(--ds-spacing-xs);
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-xxs);
    }
    .provider-header {
      /*display: flex;*/
      align-items: center;
      gap: var(--ds-spacing-m);
      padding-bottom: var(--ds-spacing-s);
      flex: 1;
    }
    .provider-offer {
        display: flex;
    }
    .provider-logo {
      width: 60px;
      height: 60px;
      border-radius: var(--ds-radius-l);
      background-color: var(--ds-background-white);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      overflow: hidden;
    }
    .provider-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .provider-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-xxxs);
    }
    .provider-name {
      font-size: var(--ds-font-size-l);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
    }
    .provider-rating {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      font-size: 12px;
      color: var(--ds-font-text-neutral-muted);
    }
    .provider-rating .stars {
      display: flex;
      gap: 2px;
    }
    .provider-rating .star {
      color: var(--ds-icon-brand-regular);
      font-size: 14px;
    }
    /* ===== PRICE SECTION ===== */
    .price-section {
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-xxs);
    }
    .price-value {
      font-size: var(--ds-font-size-xl);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
      display: flex;
      align-items: baseline;
      gap: var(--ds-spacing-xs);
    }
    .price-amount {
      display: flex;
      align-items: baseline;
      gap: var(--ds-spacing-xxs);
    }
    .price-currency {
      font-size: var(--ds-font-size-xl);
      color: var(--ds-font-headline-neutral-regular);
      font-weight: var(--ds-font-weight-l);
    }
    .price-period {
      font-size: 12px;
      color: var(--ds-font-text-neutral-muted);
      font-weight: var(--ds-font-weight-m);
    }
    .price-help {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-m);
      color: var(--ds-font-text-neutral-regular);
      cursor: help;
    }
    .price-help .icn {
      font-size: 14px;
    }
    /* ===== DETAILS SECTION ===== */
    .details-section {
      display: flex;
      flex-direction: column;
    }
    .detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--ds-spacing-xs);
      padding: var(--ds-spacing-xxs) 0;
      background-color: var(--ds-background-white);
    }
    .detail-label {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-m);
    }
    .detail-value {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-l);
      text-align: right;
    }
    /* ===== ACTION LINK ===== */
    .action-link {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: var(--ds-spacing-xxxs);
      font-size: 19px;
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-text-brand-regular);
      text-decoration: none;
      cursor: pointer;
      padding: var(--ds-spacing-xs) 0;
      transition: opacity 0.2s ease;
      border: none;
      background: none;
      font-family: inherit;
    }
    .action-link:hover {
      opacity: 0.8;
    }
    .action-link .icn {
      font-size: 14px;
    }
    /* ===== DRAWER OVERLAY ===== */
    .drawer-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--ds-overlay-neutral-dark, rgba(0, 0, 0, 0.5));
      z-index: 999;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .drawer-overlay.open {
      display: block;
      opacity: 1;
    }
    /* ===== DRAWER ===== */
    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 90vw;
      max-width: 600px;
      height: 100vh;
      background-color: white;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
    }
    .drawer.open {
      transform: translateX(0);
    }
    .drawer-header {
      display: block;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--ds-spacing-xs);
      background-color: var(--ds-background-neutral-muted);
    }
    .drawer-wrapper-provider-offer{
        padding: var(--ds-spacing-xs);
    }
    .drawer-title {
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
      margin: 0;
      /*flex: 1;*/
      padding: var(--ds-spacing-xs) var(--ds-spacing-xs) 0 var(--ds-spacing-xs);
    }
    .drawer-back-button {
      align-items: center;
      justify-content: center;
      gap: var(--ds-spacing-xxxs);
      padding: var(--ds-spacing-xxs) 0;
      background: none;
      border: none;
      cursor: pointer;
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-m);
      color: var(--ds-font-text-neutral-regular);
      font-family: inherit;
      transition: opacity 0.2s ease;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .drawer-back-button:hover {
      opacity: 0.8;
    }
    .drawer-back-button .icn {
      font-size: 16px;
      order: 2;
      color: var(--ds-icon-brand-regular);
    }
    .drawer-content {
      flex: 1;
      overflow-y: auto;
      padding: var(--ds-spacing-xs);
    }
    .drawer-section-content {
      display: flex;
      flex-direction: column;
      /*gap: var(--ds-spacing-s);*/
      padding: var(--ds-spacing-xs) 0 0 0;
    }
    .drawer-subsection-item {
      display: flex;
      flex-direction: column;
      /*gap: var(--ds-spacing-s);*/
      padding: var(--ds-spacing-xxs);
      gap: var(--ds-spacing-xxs);
      /*background-color: var(--ds-background-neutral-light);*/
      border-radius: var(--ds-stroke-l);
      margin-bottom: var(--ds-spacing-xxs);
    }
    .drawer-subsection-item-label {
        font-size: var(--ds-font-size-m);
        color: var(--ds-font-text-neutral-regular);
        font-weight: var(--ds-font-weight-l);
        word-break: break-word;
        padding-bottom: var(--ds-spacing-xxs);
        border-bottom: var(--ds-stroke-m) solid var(--ds-border-neutral-regular);
    }
    .drawer-list-item {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--ds-spacing-m);
      padding: var(--ds-spacing-xxs) 0;
      border-radius: var(--ds-radius-l);
      border-left: 4px solid transparent;
      transition: all 0.2s ease;
    }
    .drawer-list-item:hover {
      background-color: var(--ds-background-white);

    }
    .drawer-list-item.highlight {
        background-color: var(--ds-background-brand-light);
        border: var(--ds-stroke-m) solid var(--ds-border-brand-muted);
        padding: var(--ds-spacing-xxxs);
    }
    .drawer-list-item.highlight .drawer-item-label {
      font-weight: var(--ds-font-weight-m);
    }
    .drawer-list-item.highlight .drawer-item-value {
      font-weight: var(--ds-font-weight-l);
    }
    .drawer-item-label {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-m);
      word-break: break-word;
    }
    .drawer-item-value {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-l);
      text-align: left;
      word-break: break-word;
      line-height: 1.4;
    }

    /* ===== TAB GROUP OVERRIDES ===== */
    .drawer-section-content {
        border-top: var(--ds-stroke-m) solid var(--ds-border-neutral-regular);
    }



    ds-tab-group::part(tab) {
        padding: var(--ds-spacing-xxxs) var(--ds-spacing-s) var(--ds-spacing-xxxs) var(--ds-spacing-s);
        justify-content: end;
    }

    /* ===== STEP CARD STATES ===== */
    .step-card {
      background: var(--ds-background-white);
      border: var(--ds-stroke-m) solid var(--ds-border-neutral-muted);
      border-radius: var(--ds-radius-xl);
      overflow: visible;
      transition: all 0.3s ease-in-out;
      position: relative;
      margin-bottom: var(--ds-spacing-xs);
    }

    .step-card.editing[data-step="9"] {
        background: none;
        border: none;
    }
    .step-card.editing {
      border: 1px solid var(--ds-border-brand-muted);
      box-shadow: 0px 0px 16px var(--ds-border-neutral-regular);
    }
    .step-card.editing[data-step="9"] {
        background: none;
        border: none;
        box-shadow: none;
    }
    .step-card.locked {
      opacity: 0.7;
    }
    .step-card.completed {
      border: var(--ds-stroke-m) solid var(--ds-border-success-regular);
    }
    .step-card.completed ds-ribbon {
      position: absolute;
      top: -16px;
      left: -2px;
      z-index: 10;
      display: block;
    }
    .step-card:not(.completed) ds-ribbon {
      display: none;
    }
    /* ===== CARD HEADER ===== */
    .step-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ds-spacing-s) var(--ds-spacing-xs);
      cursor: pointer;
      user-select: none;
      border-bottom: 1px solid var(--ds-border-neutral-light);
      transition: background-color 0.2s ease;
      background-color: transparent;
    }
    .step-header:hover:not(.locked-header) {
      background-color: var(--ds-background-white);
    }
    .step-card.completed .step-header {
      border-bottom: none;
      cursor: default;
      background-color: transparent;
    }
    .step-card.completed .step-header:hover {
      background-color: transparent;
    }
    .step-card.editing .step-header {
      border-bottom: 1px solid var(--ds-border-neutral-light);
    }
    .step-card.locked .step-header {
      cursor: default;
    }
    .step-card.locked .step-header:hover {
      background-color: white;
    }
    .step-header-left {
      display: flex;
      align-items: center;
      flex: 1;
    }
    .step-header-right {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      margin-left: var(--ds-spacing-xs);
    }
    .step-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ds-grid-size-quadruple);
      height: var(--ds-grid-size-quadruple);
      margin-right: var(--ds-spacing-xxs);
      font-size: 24px;
      flex-shrink: 0;
      color: var(--ds-font-text-neutral-regular);
    }
    .step-icon.icn {
      font-size: 24px;
    }
    .step-card.editing .step-icon {
      color: var(--ds-icon-neutral-regular);
    }
    .step-card.completed .step-icon {
      color: var(--ds-font-text-neutral-regular);
    }
    .step-card.locked .step-icon {
      color: var(--ds-font-text-neutral-muted);
    }
    .step-title {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .step-title h2 {
      font-size: var(--ds-font-size-l);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
      margin: 0;
    }
    .step-card.locked .step-title h2 {
      color: var(--ds-font-text-neutral-muted);
    }
    .step-card.completed .step-title h2 {
      color: var(--ds-font-text-neutral-regular);
    }
    .step-subtitle {
      font-size: 12px;
      color: var(--ds-font-text-neutral-muted);
      display: none;
    }
    .step-card.completed .step-subtitle {
      display: none;
    }
    .change-button-link {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xxxs);
      font-size: 19px;
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-text-brand-regular);
      text-decoration: none;
      cursor: pointer;
      white-space: nowrap;
      transition: opacity 0.2s ease;
      border: none;
      background: none;
      font-family: inherit;
    }
    .change-button-link:hover {
      opacity: 0.8;
    }
    /* ===== CARD CONTENT ===== */
    .step-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
      padding: 0;
    }
    .step-card.editing .step-content {
      max-height: 1200px;
      padding: var(--ds-spacing-xs);
    }
    .step-form {
      display: flex;
      flex-direction: column;
    }
    /* ===== CONDITIONAL FIELD ANIMATION ===== */
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
    max-height: 0;
  }
  to {
    opacity: 1;
    transform: translateY(0);
    max-height: 500px;
  }
}

    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-xxxs);
      transition: all 0.3s ease;
    }
    .form-group label {
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-m);
      color: var(--ds-font-text-neutral-regular);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .form-group label .label-text {
      flex: 1;
    }
    .form-group label .info-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      margin-left: var(--ds-spacing-xs);
      flex-shrink: 0;
      cursor: help;
      color: var(--ds-font-text-neutral-muted);
    }
    .form-actions-wrapper {
        display: flex;
    }
    .form-actions {
      display: flex;
      gap: var(--ds-spacing-xs);
      flex: 1;
      /*margin-top: var(--ds-spacing-xs);*/
    }
    .form-actions-product {
        text-align: right;
    }
    .form-actions-provider-name {
        font-size: var(--ds-font-size-m);
    }
    .form-actions-price-amount {
        font-size: var(--ds-font-size-l);
        font-weight: var(--ds-font-weight-l);
    }
    .form-actions-price-help {
        font-size: var(--ds-font-size-s);
        font-weight: var(--ds-font-weight-m);
    }


    .form-actions.full-width {
      flex-direction: column;
    }
    .form-actions.full-width > div {
      display: flex;
      gap: var(--ds-spacing-xs);
    }
    ds-button[appearance="primary"] {
      --ds-button-width: 100%;
    }
    .form-actions ds-button {
      min-height: 48px;
    }
    /* ===== FORM LAYOUT SYSTEM ===== */
.form-row {
  display: grid;
  gap: var(--ds-spacing-xs);
}
.form-row.columns-1 {
  grid-template-columns: 1fr;
}
.form-row.columns-2 {
  grid-template-columns: 1fr 1fr;
}
.form-row.columns-3 {
  grid-template-columns: 1fr 1fr 1fr;
}
.form-row.columns-4 {
  grid-template-columns: 1fr 1fr 1fr 1fr;
}
/* Mobile: Alle Spalten werden zu 1 Spalte */
@media (max-width: 768px) {
  .form-row.columns-2,
  .form-row.columns-3,
  .form-row.columns-4 {
    grid-template-columns: 1fr;
  }
}
    /* ===== CONSENT CHECKBOX STYLING ===== */
    .consent-section {
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-s);
    }
    .consent-checkbox-wrapper {
      display: flex;
      align-items: flex-start;
    }
    ds-checkbox {
      flex-shrink: 0;
      margin-top: 2px;
    }
    .consent-text {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      line-height: 1.5;
    }
    .consent-text a {
      color: var(--ds-font-text-neutral-regular);
      text-decoration: underline;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }
    .consent-text a:hover {
      opacity: 0.8;
    }
    .disclaimer-text {
        padding: var(--ds-spacing-xs) 0;
        font-size: var(--ds-font-size-s);
        color: var(--ds-font-text-neutral-regular);
    }
    .disclaimer-text a {
        color: var(--ds-font-text-neutral-regular);
        text-decoration: underline;
        cursor: pointer;
        transition: opacity 0.2s ease;
    }
    .disclaimer-text a:hover {
      opacity: 0.8;
    }

/* ===== COMPLETION MODAL ===== */
.completion-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 2000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.completion-overlay.open {
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 1;
}

.completion-modal {
  background: white;
  border-radius: var(--ds-radius-xl);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  max-width: 500px;
  width: 90%;
  animation: modalSlideIn 0.3s ease;
  overflow: hidden;
  text-align: center;
}

.completion-modal-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--ds-spacing-m);
  padding: var(--ds-spacing-xl) var(--ds-spacing-m) var(--ds-spacing-m) var(--ds-spacing-m);
  background: linear-gradient(135deg, var(--ds-palette-violet5) 0%, var(--ds-palette-orange10) 100%);
  border-bottom: 1px solid var(--ds-palette-orange20);
}

.completion-modal-header .icn {
  font-size: 64px;
  color: var(--ds-palette-grey80);
  animation: checkmarkAnimation 0.6s ease;
}

@keyframes checkmarkAnimation {
  0% {
    opacity: 0;
    transform: scale(0);
  }
  50% {
    opacity: 1;
    transform: scale(1.1);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

.completion-modal-header h2 {
  margin: 0;
  font-size: var(--ds-font-size-xl);
  font-weight: var(--ds-font-weight-l);
  color: var(--ds-palette-grey80);
}

.completion-modal-content {
  padding: var(--ds-spacing-m);
  color: var(--ds-font-text-neutral-regular);
  font-size: var(--ds-font-size-m);
  line-height: 1.6;
}

.completion-modal-content p {
  margin: var(--ds-spacing-s) 0;
}

.completion-modal-content p:first-child {
  margin-top: 0;
  font-size: var(--ds-font-size-l);
  font-weight: var(--ds-font-weight-l);
  color: var(--ds-font-headline-neutral-regular);
}

.completion-modal-footer {
  padding: var(--ds-spacing-m);


  display: flex;
  justify-content: center;
}

.completion-modal-footer ds-button {
  min-height: 48px;
  min-width: 200px;
}


/* ===== CHECKBOX VALIDATION STYLING ===== */
ds-checkbox[invalid] {
  --ds-checkbox-border-color: var(--ds-border-danger-regular);
  --ds-checkbox-error-message-color: var(--ds-font-text-danger-regular);
}

ds-checkbox[invalid]::after {
  content: attr(error-message);
  display: block;
  font-size: var(--ds-font-size-s);
  color: var(--ds-font-text-danger-regular);
  margin-top: var(--ds-spacing-xxxs);
}

.consent-checkbox-wrapper ds-checkbox[invalid] {
  border: 1px solid var(--ds-border-danger-regular);
  border-radius: var(--ds-radius-m);

}

.newsletter-error {
    color: var(--ds-font-text-danger);
    font-size: var(--ds-font-size-s);
}

    /* ===== COMPLETED CONTENT ===== */
    .step-completed-content {
      display: none;
      padding: var(--ds-spacing-xs);
      /*background-color: white;*/
    }
    .step-card.completed .step-completed-content {
      display: block;
    }
    .completed-data {
      display: grid;
      gap: var(--ds-spacing-xs);
    }
    .completed-data-row {
      display: flex;
      flex-direction: column;
    }
    .data-item {
      display: grid;
      grid-template-columns: 1fr 1fr;
      justify-content: space-between;
      align-items: top;
      gap: var(--ds-spacing-xs);
      padding: var(--ds-spacing-xxs) 0;
      background-color: var(--ds-background-white);
    }
    .data-label {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-m);
      text-align: left;
      word-break: break-word;
    }
    .data-value {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-l);
      text-align: left;
      word-break: break-word;
    }

    /* ===== TOAST ANIMATIONS ===== */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(100%);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideOutDown {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(100%);
  }
}

    /* ===== SUCCESS MESSAGE ===== */
    .success-message {
      display: none;
      padding: var(--ds-spacing-m);
      margin-bottom: var(--ds-spacing-xl);
      background-color: var(--ds-background-success-light);
      border: 1px solid var(--ds-border-success-regular);
      border-radius: var(--ds-radius-xl);
      color: var(--ds-font-text-success-regular);
      text-align: center;
      font-weight: 500;
    }
    .success-message.show {
      display: block;
      animation: slideDown 0.3s ease;
    }
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    ds-input {
      width: 100%;
    }
    ds-select {
      width: 100%;
    }
    html {
      scroll-behavior: smooth;
    }
    .scroll-target {
      scroll-margin-top: 280px;
    }
    /* ===== DOCUMENTS BOX ===== */
    .documents-box {
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-xxs);
      margin-top: var(--ds-spacing-xs);
    }
    .documents-header {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      padding-bottom: var(--ds-spacing-xxs);
    }
    .documents-icon {
      font-size: 24px;
      color: var(--ds-icon-brand-regular);
      flex-shrink: 0;
    }
    .documents-title {
      font-size: var(--ds-font-size-l);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
      margin: 0;
    }
    ds-alert {
      --ds-alert-border-radius: var(--ds-radius-l);
      width: 100%;
    }
    .info-box {
        display: flex;
      align-items: center;
      gap: var(--ds-spacing-xxs);
      padding: var(--ds-spacing-xs);
      border-radius: var(--ds-radius-l);
      background-color: var(--ds-background-info-light);
      border: var(--ds-stroke-m) solid var(--ds-border-info);
    }
    .info-box-icon {
      font-size: 24px;
      color: var(--ds-font-text-info);
      flex-shrink: 0;
    }
    .info-box-name {
      flex: 1;
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-info);
      font-weight: var(--ds-font-weight-m);
      word-break: break-word;
      line-height: 1.4;
    }
    /* ===== DOKUMENT LISTE ===== */
    .documents-list {
      display: flex;
      flex-direction: column;
    }
    .documents-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ds-spacing-xs) 0;
      border-bottom: 1px solid var(--ds-border-neutral-light);
    }
    .documents-list-title {
        flex: 1;
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
    }
    .download-all-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background-color: transparent;
      border: 1px solid var(--ds-border-neutral-muted);
      border-radius: var(--ds-radius-m);
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--ds-icon-brand-regular);
      font-size: 18px;
    }
    .download-all-btn:hover {
      background-color: var(--ds-background-neutral-light);
      border-color: var(--ds-border-brand-regular);
    }
    .download-all-btn:active {
      background-color: var(--ds-background-brand-light);
    }
    /* ===== EINZELNES DOKUMENT ITEM ===== */
    .document-item {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xxs);
      padding: var(--ds-spacing-xxs);
      border-radius: var(--ds-radius-m);
      background-color: var(--ds-background-neutral-light);
      border-bottom: var(--ds-stroke-m) solid var(--ds-border-neutral-regular);
      transition: all 0.2s ease;
    }
    .document-item:hover {
      background-color: var(--ds-background-brand-light);
    }
    .document-icon {
      font-size: 24px;
      color: var(--ds-icon-neutral-regular);
      flex-shrink: 0;
    }
    .document-name {
      flex: 1;
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-m);
      word-break: break-word;
      line-height: 1.4;
    }
    .download-link {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background-color: transparent;
      border: var(--ds-stroke-m) solid var(--ds-border-brand-regular);
      border-radius: var(--ds-radius-l);
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--ds-icon-brand-regular);
      font-size: 16px;
      text-decoration: none;
      flex-shrink: 0;
    }
    .download-link:hover {
      background-color: var(--ds-background-brand-light);
      border-color: var(--ds-border-brand-regular);
    }
    .download-link:active {
      transform: scale(0.95);
    }
    /* ===== FOOTER ===== */
    footer {
      background-color: #505050;
      padding: var(--ds-spacing-l);
      margin-top: var(--ds-spacing-xl);
    }
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .footer-links {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--ds-spacing-l);
      flex-wrap: wrap;
    }
    .footer-link {
      text-decoration: none;
      color: white;
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-m);
      transition: opacity 0.2s ease;
      cursor: pointer;
    }
    .footer-link:hover {
      opacity: 0.8;
    }
    /* ===== RESPONSIVE TABLET ===== */
    @media (max-width: 1024px) {
      .checkout-wrapper {
        grid-template-columns: 1fr;
      }
      .provider-box-item {
        position: static;
      }
    }
    /* ===== RESPONSIVE MOBILE ===== */
    @media (max-width: 768px) {
      .header-top {
        padding: 10px var(--ds-spacing-m);
      }
      .main-content {
        padding: var(--ds-spacing-s);
      }
      .checkout-wrapper {
        grid-template-columns: 1fr;
      }
      .drawer {
        max-width: 100%;
        width: 100%;
      }
      .completed-data-row {
        grid-template-columns: 1fr;
      }
      .drawer-list-item {
        grid-template-columns: 1fr;
        gap: var(--ds-spacing-xxxs);
        border-bottom: var(--ds-stroke-m) solid var(--ds-border-neutral-muted);
      }
      .drawer-item-label {
        text-align: left;
        font-weight: var(--ds-font-weight-l);
      }
      .drawer-item-value {
        text-align: left;
        font-weight: var(--ds-font-weight-m);
      }
      .documents-header {
        gap: var(--ds-spacing-s);
      }
      .document-item {
        flex-wrap: wrap;
      }
      .documents-list-title {
        font-size: var(--ds-font-size-m);
      }
      .footer-links {
        gap: var(--ds-spacing-m);
      }
      .footer-link {
        font-size: var(--ds-font-size-s);
      }
    }
    @media (max-width: 480px) {
      .header-top {
        padding: 10px var(--ds-spacing-s);
      }
      .header-contact {
        gap: var(--ds-spacing-s);
      }
      .main-content {
        padding: var(--ds-spacing-s);
      }
      .footer-links {
        gap: var(--ds-spacing-s);
        flex-direction: column;
        text-align: center;
      }
      .footer-link {
        font-size: var(--ds-font-size-s);
      }
    }

    /* ===== TEST MODE MODAL ===== */
.test-mode-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 2000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.test-mode-overlay.open {
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 1;
}

.test-mode-modal {
  background: var(--ds-background-white);
  border-radius: var(--ds-radius-xl);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  max-width: 500px;
  width: 90%;
  animation: modalSlideIn 0.3s ease;
  overflow: hidden;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.test-mode-modal-header {
  display: flex;
  align-items: center;
  gap: var(--ds-spacing-xxs);
  padding: var(--ds-spacing-xs);
  background-color: var(--ds-background-info-light);
  border-bottom: 1px solid var(--ds-border-info);
}

.test-mode-modal-header .icn {
  font-size: 24px;
  color: var(--ds-font-text-info);
  flex-shrink: 0;
}

.test-mode-modal-header h2 {
  margin: 0;
  font-size: var(--ds-font-size-l);
  font-weight: var(--ds-font-weight-l);
  color: var(--ds-font-text-info);
}

.test-mode-modal-content {
  padding: var(--ds-spacing-xs) var(--ds-spacing-m);
  color: var(--ds-font-text-neutral-regular);
  font-size: var(--ds-font-size-m);
  line-height: 1.6;
}

.test-mode-modal-footer {
  padding: var(--ds-spacing-xs);
  border-top: 1px solid var(--ds-border-neutral-light);
  display: flex;
  justify-content: flex-end;
}

.test-mode-modal-footer ds-button {
  min-height: 40px;
}
  </style>
</head>
<body>
  <!-- STICKY HEADER -->
  <div class="sticky-header">
    <!-- Header Top -->
    <div class="header-top">
      <a href="#" class="header-logo">
        <img src="img/verivox-logo.png" alt="Verivox" />
      </a>
      <div class="header-contact">
        <div class="header-phone">
          <span class="icn icn-phone-filled" aria-hidden="true"></span>
          <span>0621 777 00 10</span>
        </div>
        <div class="header-hours">
          <strong>Mo-Fr 8-22 Uhr</strong>
          Sa, So 9-22 Uhr
        </div>
      </div>
    </div>
    <!-- DS-STEPS Progress Bar -->
    <div class="progress-wrapper">
      <!--<ds-steps
        id="checkoutSteps"
        interactive
        current="1"
        complete="1"
        circle-mode="counter"
      >-->
        <!-- Steps werden dynamisch eingef√ºgt -->
      </ds-steps>
    </div>
    <!-- Storage Info -->
    <div class="storage-info">
      <span class="icn icn-database-filled" aria-hidden="true"></span>
      <span id="storage-status">Daten gespeichert</span>
      <button id="clear-storage" type="button" aria-label="Gespeicherte Daten l√∂schen">L√∂schen</button>
    </div>
  </div>
  <!-- MAIN -->
  <main>
    <!-- MAIN CONTENT -->
    <div class="main-content">
        <div class="checkout-intro">
            <div class="intro-header">
              <img src="https://js.vxcdn.com/vx/illustrations/latest/svg/DocumentApproved.svg" alt="Checkout Erfolg" class="intro-illustration" />
              <div class="intro-text">
                <h1>Nur wenige Schritte bis zum Abschluss</h1>
                <p>Bitte pr√ºfen und vervollst√§ndigen Sie Ihre Angaben</p>
              </div>
            </div>
          </div>
      <!-- CHECKOUT WRAPPER - GRID LAYOUT -->
      <div class="checkout-wrapper">
        <!-- CHECKOUT CONTAINER (LEFT SIDE) -->
        <div class="checkout-container">
          <div class="success-message" id="successMessage">
            ‚úì Checkout erfolgreich abgeschlossen!
          </div>
          <div class="checkout-steps" id="checkoutSteps-container">
            <!-- Wird dynamisch gef√ºllt -->
          </div>
        </div>
        <!-- PROVIDER BOXES (RIGHT SIDE) - DYNAMISCH GENERIERT -->
        <div class="provider-boxes-wrapper" id="providerBoxesWrapper">
          <!-- Wird dynamisch gef√ºllt -->
        </div>
      </div>
    </div>
  </main>
  <!-- FOOTER -->
  <footer>
    <div class="footer-content">
      <nav class="footer-links">
        <a href="#" onclick="openTestModeModal(); return false;" class="footer-link">Datenschutz</a>
        <a href="#" onclick="openTestModeModal(); return false;"class="footer-link">AGB</a>
        <a href="#" onclick="openTestModeModal(); return false;"class="footer-link">Impressum</a>
        <a href="#" onclick="openTestModeModal(); return false;"class="footer-link">Cookies</a>
        <a href="#" onclick="openTestModeModal(); return false;"class="footer-link">Vertr√§ge k√ºndigen</a>
      </nav>
    </div>
  </footer>
  <!-- DRAWER OVERLAY -->
  <div class="drawer-overlay" id="drawerOverlay"></div>
  <!-- DRAWER - WIRD DYNAMISCH GEF√úLLT -->
  <div class="drawer" id="tariffDrawer">
    <div class="drawer-header">
        <button class="drawer-back-button" id="closeDrawer" type="button" aria-label="Drawer schlie√üen">
            <span class="icn icn-angle-left-filled" aria-hidden="true"></span>
            <span>Zur√ºck</span>
          </button>
    </div>
  <div class="drawer-wrapper-provider-offer">
    <div class="provider-offer" id="drawerProviderOffer">
        <!-- Wird dynamisch gef√ºllt -->
    </div>
</div>
    <!--<h2 class="drawer-title" id="drawerTitle">Tarif- und Preisdetails</h2>-->
    <div class="drawer-content" id="drawerContent">
      <!-- Wird dynamisch gef√ºllt -->
    </div>
  </div>
</div>
  <script>
    // ===== TEST-DATEN KONFIGURATION =====
    // √Ñndere USE_TEST_DATA auf true, um die Testdaten zu laden
    const USE_TEST_DATA = true; // <-- HIER UMSCHALTEN zum Laden/Entfernen von Testdaten

    const TEST_DATA = {
      1: {
        salutation: 'Herr',
        firstName: 'Kim',
        lastName: 'Meier',
        email: 'kim.meier@gmail.com'
      },
      3: {
        zip: '04177',
        city: 'Leipzig',
        street: 'Ahlfeldstr.',
        housenumber: '4',
        phone: '015212345678'
      },
      7: {
        iban: 'DE89 3704 0044 0532 0130 00',
        bank: 'Commerzbank'
      }

    };

    // ===== SIMPLE TEST MODE MODAL (GANZ OBEN - VOR ALLEM ANDEREN) =====
function initTestModeModal() {
  // Erstelle Modal HTML
  const modalHTML = '<div class="test-mode-overlay" id="testModeOverlay"><div class="test-mode-modal"><div class="test-mode-modal-header"><span class="icn icn-info-filled" aria-hidden="true"></span><h2>Testmodus</h2></div><div class="test-mode-modal-content"><p>Das ist eine <b>Simulation</b> im Rahmen einer Nutzerbefragung. </br>Externe <b>Links und Downloads sind deaktiviert</b>.</p></div><div class="test-mode-modal-footer"><ds-button text="Verstanden" appearance="primary" id="testModeCloseBtn" type="button"></ds-button></div></div></div>';
  document.body.insertAdjacentHTML('beforeend', modalHTML);

  // Close Button
  const closeBtn = document.getElementById('testModeCloseBtn');
  if (closeBtn) {
    closeBtn.addEventListener('click', closeTestModeModal);
  }

  // Overlay Click
  const overlay = document.getElementById('testModeOverlay');
  if (overlay) {
    overlay.addEventListener('click', function(e) {
      if (e.target === overlay) {
        closeTestModeModal();
      }
    });
  }

  // Escape Key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeTestModeModal();
    }
  });
}

// Modal √∂ffnen
function openTestModeModal() {
  const overlay = document.getElementById('testModeOverlay');
  if (overlay) {
    overlay.classList.add('open');
    document.body.style.overflow = 'hidden';
    console.log('‚úì Test Mode Modal opened');
  }
}

// Modal schlie√üen
function closeTestModeModal() {
  const overlay = document.getElementById('testModeOverlay');
  if (overlay) {
    overlay.classList.remove('open');
    document.body.style.overflow = '';
    console.log('‚úì Test Mode Modal closed');
  }
}

// ===== STICKY CHECKOUT FOOTER MANAGER =====
class StickyCheckoutFooter {
  constructor() {
    this.init();
  }

  init() {
    this.createFooter();
    this.setupEventListeners();
    console.log('‚úì StickyCheckoutFooter initialized');
  }

  createFooter() {
    const footerHTML = `
    <div class="sticky-checkout-footer-wrapper">
        <div class="sticky-checkout-footer" id="stickyCheckoutFooter" style="max-width:980px;">

            <div class="sticky-footer-content">
                <div class="sticky-footer-button">
                    <ds-button text="Kauf abschlie√üen" appearance="primary" id="stickyCheckoutBtn" type="button" icon-right="check-filled"></ds-button>
                </div>
                <div>Kein Risiko - 14 Tage Widerrufsrecht</div>
            </div>
            <div class="sticky-footer-product-wrapper">
                <div class="provider-logo"><img id="stickyProviderLogo"/></div>

                <div class="sticky-footer-product">
                    <span class="sticky-footer-provider-name" id="stickyProviderName">-</span>
                    <span class="sticky-footer-price-amount" id="stickyPriceAmount">-</span>
                    <span class="sticky-footer-price-help" id="stickyPriceHelp">-</span>
                </div>
            </div>

        </div>
    </div>;
    `
    document.body.insertAdjacentHTML('beforeend', footerHTML);
  }

  setupEventListeners() {
  const stickyBtn = document.getElementById('stickyCheckoutBtn');
  const self = this;

  if (stickyBtn) {
    stickyBtn.addEventListener('click', function(e) {
      e.preventDefault();

        // üîë NEUE VALIDIERUNG HIER
      // Pr√ºfe ob ALLE Steps vor Step 9 completed sind
      const checkoutManager = window.checkoutManager; // Siehe unten
      if (!checkoutManager.validateAllStepsCompleted()) {
        console.log('‚ùå Validation failed - nicht alle Steps sind abgeschlossen');
        return; // Verhindere Checkout
      }

      const step9Card = document.querySelector('[data-step="9"]');
      if (step9Card) {
        // Zeige Completion Modal direkt (ohne Checkbox-Validierung)
        self.showCompletionModal();
      }
    });
  }

  // Beobachte Step 9 Sichtbarkeit
  setTimeout(() => {
    self.observeStep9();
  }, 500);
}

  observeStep9() {
    const step9Card = document.querySelector('[data-step="9"]');
    if (!step9Card) return;

    const self = this;
    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        const footer = document.getElementById('stickyCheckoutFooter');

        if (entry.isIntersecting) {
          footer.classList.remove('show');
          document.body.classList.remove('sticky-footer-visible');
          console.log('‚úì Last Step visible');
        } else if (!document.querySelector('[data-step="9"].completed')) {
          footer.classList.add('show');
          document.body.classList.add('sticky-footer-visible');
          self.updateProductInfo();
          console.log('‚úì Last Step not visible');
        }
      });
    }, {
      rootMargin: '1000px 0px 0px 0px',
      threshold: 0.7
    });

    observer.observe(step9Card);
  }

  updateProductInfo() {
    const provider = CHECKOUT_CONFIG.providers[0];
    if (provider) {
      document.getElementById('stickyProviderLogo').src = provider.logo;
      document.getElementById('stickyProviderName').textContent = provider.name;
      document.getElementById('stickyPriceAmount').textContent = provider.price.toFixed(2) + ' ‚Ç¨';
      document.getElementById('stickyPriceHelp').textContent = provider.pricePeriod;
    }
  }

  showCompletionModal() {
    const modalHTML = '<div class="completion-overlay" id="completionOverlay"><div class="completion-modal"><div class="completion-modal-header"><span class="icn icn-check-circle-filled" aria-hidden="true"></span><h2>Checkout abgeschlossen</h2></div><div class="completion-modal-content"><p>Vielen Dank f√ºr Ihre Teilnahme!</p><p>Der Checkout-Test ist mit dieser Seite nun abgeschlossen.<br>Sie bekommen in der Realit√§t eine Best√§tigungsseite angezeigt. Diese ist jedoch nicht Teil dieser Umfrage.</p></div><div class="completion-modal-footer"><ds-button text="Zur Startseite" appearance="primary" id="completionCloseBtn" type="button"></ds-button></div></div></div>';

    document.body.insertAdjacentHTML('beforeend', modalHTML);

    const overlay = document.getElementById('completionOverlay');
    const closeBtn = document.getElementById('completionCloseBtn');

    overlay.classList.add('open');
    document.body.style.overflow = 'hidden';

    closeBtn.addEventListener('click', function() {
      overlay.classList.remove('open');
      document.body.style.overflow = '';
      console.log('Completion Modal closed - Clearing storage and reloading page...');

      localStorage.removeItem('verivox_checkout_data');
      localStorage.removeItem('verivox_checkout_state');
      console.log('‚úì LocalStorage cleared');

      // Scrolle nach oben UND dann reload
      window.scrollTo({
      top: 0,
      left: 0,
      behavior: 'instant' // üëà Sofort, nicht animiert
    });

    // Reload nach kurzer Verz√∂gerung
    setTimeout(function() {
      location.reload();
    }, 100);
    });

    console.log('‚úì Checkout completed');
  }
}

    // ===== CHECKOUT CONFIGURATION (JSON) =====
    const CHECKOUT_CONFIG = {
      steps: [
        {
          id: 1,
          heading: 'Lieferanschrift',
          icon: 'icn-man-document-outlined',
          layout: [
        {
          type: 'row',
          columns: 1,
          fields: ['salutation']
        },
        {
        type: 'row',
          columns: 1,
          fields: ['grade']
        },
        {
          type: 'row',
          columns: 1,
          fields: ['firstName']
        },
        {
          type: 'row',
          columns: 1,
          fields: ['lastName']
        },
        {
          type: 'row',
          columns: 1,
          fields: ['email']
        },
        {
          type: 'row',
          columns: 1,
          fields: ['emailConfirm']
        }

      ],
          fields: [
            {
              id: 'salutation',
              type: 'select',
              label: 'Anrede',
              required: true,
              valid: true,
              placeholder: 'Bitte Anrede w√§hlen',
              options: [
                { value: '', label: 'Bitte Anrede w√§hlen' },
                { value: 'Herr', label: 'Herr' },
                { value: 'Frau', label: 'Frau' },
                { value: '', label: 'Divers' }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte w√§hlen Sie eine Anrede'
              }
            },
            {
              id: 'grade',
              type: 'select',
              label: 'Titel',
              required: false,
              valid: true,
              placeholder: 'Titel (optional)',
              options: [
                { value: '', label: 'Titel (optional)' },
                { value: 'Dr.', label: 'Dr.' },
                { value: 'Prof.', label: 'Prof.' },
                { value: 'Prof. Dr.', label: 'Prof. Dr.' }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: '-'
              }
            },
            {
              id: 'firstName',
              type: 'input',
              inputType: 'text',
              label: 'Vorname',
              required: true,
              valid: true,
              placeholder: 'Max',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Vorname muss mindestens 2 Zeichen lang sein'
              }
            },
            {
              id: 'lastName',
              type: 'input',
              inputType: 'text',
              label: 'Nachname',
              required: true,
              valid: true,
              placeholder: 'Mustermann',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Nachname muss mindestens 2 Zeichen lang sein'
              }
            },
            {
              id: 'email',
              type: 'input',
              inputType: 'email',
              label: 'E-Mail-Adresse',
              required: true,
              valid: true,
              placeholder: 'max@example.de',
              validation: {
                validate: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
                error: 'Bitte geben Sie eine g√ºltige E-Mail-Adresse ein'
              }
            }
          ],
          completedDataFields: [
            { label: 'Name', valueIds: ['salutation', 'firstName', 'lastName'], transform: (vals) => `${vals[0]} ${vals[1]} ${vals[2]}` },
            { label: 'Email', valueId: 'email' }
          ]

        },
        {
          id: 2,
          heading: 'Beruf',
          icon: 'icn-document-seal-outlined',
          layout: [
        {
          type: 'row',
          columns: 1,
          fields: ['profession']
        }
      ],
          fields: [
            {
                id: 'profession',
                type: 'select',
                label: 'Ihre derzeitige Berufsbezeichnung',
                required: true,
                placeholder: 'Bitte w√§hlen...',
                options: [
                { value: '', label: 'Bitte erg√§nzen Sie die genaue aktuelle Berufbezeichnung' },
                {
                            label: "Abfallbeseitiger",
                            value: "Abfallbeseitiger"
                        },
                        {
                            label: "Abfallentsorger",
                            value: "Abfallentsorger"
                        },
                        {
                            label: "Zwirner",
                            value: "Zwirner"
                        }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte erg√§nzen Sie die genaue aktuelle Berufbezeichnung'
              }
            }
          ],
          completedDataFields: [
            { label: 'Berufsbezeichnung', valueId: 'profession' }
          ]
        },
        {
          id: 3,
          heading: 'Kontaktadresse',
          icon: 'icn-location-outlined',
          layout: [
        {
          type: 'row',
          columns: 2,
          fields: ['zip', 'city']
        },
        {
          type: 'row',
          columns: 2,
          fields: ['street', 'housenumber']
        },
        {
          type: 'row',
          columns: 1,
          fields: ['phone']
        }
      ],
          fields: [
            {
                id: 'zip',
                type: 'input',
                inputType: 'text',
                label: 'Postleitzahl',
                required: true,
                valid: true,
                placeholder: '06911',
                validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Postleitzahl ein'
              }
            },
            {
                id: 'city',
                type: 'input',
                inputType: 'text',
                label: 'Ort',
                required: true,
                disabled: true,
                valid: true,
                placeholder: '',
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte erg√§nzen Sie den Ort an'
              }
            },
            {
                id: 'street',
                type: 'input',
                inputType: 'text',
                label: 'Stra√üe',
                valid: true,
                required: true,
                placeholder: '',
                validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Stra√üe an'
              }
            },
            {
                id: 'housenumber',
                type: 'input',
                inputType: 'text',
                label: 'Hausnummer',
                valid: true,
                required: true,
                placeholder: '',
                validation: {
                validate: (value) => value.length >= 1,
                error: 'Bitte geben Sie die Hausnummer an'
              }
            },
            {
                id: 'phone',
                type: 'input',
                inputType: 'text',
                label: 'Telefonnummer',
                required: true,
                valid: true,
                placeholder: '',
                validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Telefonnummer an'
              }
            }
          ],
          completedDataFields: [
            { label: 'Anschrift', valueIds: ['street', 'housenumber', 'zip', 'city'], transform: (vals) => `${vals[0]} ${vals[1]}, ${vals[2]} ${vals[3]}` },
            { label: 'Telefonnummer', valueId: 'phone' }
          ]
        },
        {
          id: 4,
          heading: 'Fahrzeuge',
          icon: 'icn-car-outlined',
          layout: [
        {
          type: 'row',
          columns: 1,
          fields: ['familyCars']
        }
      ],
          fields: [
            {
                id: 'familyCars',
                type: 'select',
                label: 'Anzahl der Fahrzeuge in der Familie',
                required: false,
                placeholder: 'Bitte w√§hlen...',
                options: [
                { value: 'keine', label: '0' },
                { value: '1', label: '1' },
                { value: '2', label: '2' },
                { value: '3', label: '3' },
                { value: '4', label: '4' },
                { value: '5', label: '5' },
                { value: '6', label: '6' }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte geben Sie die Anzahl der Fahrzeuge in Ihrer Familie an'
              }
            }
          ],
          completedDataFields: [
            { label: 'Fahrzeuge in der Familie', valueId: 'familyCars' }
          ]
        },
        {
          id: 5,
          heading: 'Wohnen',
          icon: 'icn-two-houses-outlined',
          layout: [
        {
          type: 'row',
          columns: 1,
          fields: ['unitLpi']
        },
        {
          type: 'row',
          columns: 2,
          fields: ['zipUnit', 'cityUnit' ]
        },
        {
          type: 'row',
          columns: 2,
          fields: ['streetUnit', 'housenumberUnit']
        }
      ],
          fields: [
          {
                id: 'unitLpi',
                type: 'select',
                label: 'RS f√ºr selbstbewohnte Wohneinheit als',
                required: false,
                placeholder: 'Bitte w√§hlen...',
                options: [
                { value: 'Mieter einer Wohnung', label: 'Mieter einer Wohnung' },
                { value: 'Eigent√ºmer eines Hauses', label: 'Eigent√ºmer eines Hauses' },
                { value: 'Eigent√ºmer einer Wohnung', label: 'Eigent√ºmer einer Wohnung' },
                { value: 'Mieter eines Hauses', label: 'Mieter eines Hauses' },
                { value: 'Mehrere WE auf Anfrage', label: 'Mehrere WE auf Anfrage' }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte geben Sie ob Rechtschutz f√ºr die selbstbewohnte WE bestehen soll'
              }
            },
          {
              id: 'zipUnit',
              type: 'input',
              inputType: 'text',
              label: 'PLZ der Immobilie',
              required: true,
              placeholder: 'PLZ',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die PLZ ein'
              }
            },
            {
              id: 'cityUnit',
              type: 'input',
              inputType: 'text',
              label: 'Ort der Immobilie',
              required: true,
              placeholder: 'Ort',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie den Ort ein'
              }
            },
            {
              id: 'streetUnit',
              type: 'input',
              inputType: 'text',
              label: 'Stra√üe',
              required: true,
              placeholder: 'Stra√üe',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Stra√üe ein'
              }
            },
            {
              id: 'housenumberUnit',
              type: 'input',
              inputType: 'text',
              label: 'Hausnummer',
              required: true,
              placeholder: 'Hausnummer',
              validation: {
                validate: (value) => value.length >= 1,
                error: 'Bitte geben Sie die Hausnummer ein'
              }
            }
          ],
          completedDataFields: [
            { label: 'Rechtschutz f√ºr selbstbewohnte Wohneinheit als', valueId: 'unitLpi' },
            { label: 'Anschrift der Wohneinheit', valueIds: ['streetUnit', 'housenumberUnit', 'zipUnit', 'cityUnit'], transform: (vals) => `${vals[0]} ${vals[1]}, ${vals[2]} ${vals[3]}` }
          ]
        },
        {
          id: 6,
          heading: 'Versicherungsbeginn',
          icon: 'icn-calendar-outlined',
          layout: [
        {
          type: 'row',
          columns: 1,
          fields: ['startIns']
        }
        ],
          fields: [
          {
              id: 'startIns',
              type: 'input',
              inputType: 'text',
              label: 'Gew√ºnschter Versicherungsbeginn',
              required: true,
              placeholder: 'TT.MM.JJJJ',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte Versicherungsbeginn angeben'
              }
            }
          ],
          completedDataFields: [
            { label: 'Gew√ºnschter Versicherungsbeginn', valueId: 'startIns' }
          ]
        },
        {
          id: 7,
          heading: 'Bankdaten',
          icon: 'icn-bank-outlined',
          layout: [
        {
          type: 'row',
          columns: 1,
          fields: ['iban']
        },
        {
          type: 'row',
          columns: 1,
          fields: ['bank']
        }
        ],
          fields: [
          {
              id: 'iban',
              type: 'input',
              inputType: 'text',
              label: 'IBAN',
              required: true,
              valid: true,
              placeholder: 'DE40',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie eine IBAN an'
              }
            },
            {
              id: 'bank',
              type: 'input',
              inputType: 'text',
              label: 'Name der Bank',
              required: true,
              placeholder: 'Kreditinstitut',
              disabled: true,
              valid: true,
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie den Namen der Bank an'
              }
            }
          ],
          completedDataFields: [
            { label: 'IBAN', valueId: 'iban' },
            { label: 'Kreditinstitut', valueId: 'bank' }
          ]
        },
        {
          id: 8,
          heading: 'Zusatzfragen',
          icon: 'icn-checklist-outlined',
          layout: [
        {
          type: 'row',
          columns: 1,
          fields: ['additionalTrue']
        },
        {
          type: 'row',
          columns: 1,
          fields: ['additionalExplication']
        }
        ],
          fields: [
          {
              id: 'additionalTrue',
              type: 'select',
              label: 'Sind Umst√§nde bekannt, die auf ein anstehendes oder bereits eingeleitetes strafrechtliches Ermittlungsverfahren hinweisen?',
              required: false,
              placeholder: 'Kurze Erl√§uterung...',
              options: [
                { value: 'nein', label: 'nein' },
                { value: 'ja', label: 'ja' }
              ],
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte w√§hlen Sie eine Option aus'
              }
            },
        {
            id: 'additionalExplication',
              type: 'input',
              inputType: 'text',
              label: 'Bitte erl√§utern Sie kurz um was es sich handelt.',
              required: false,
              placeholder: 'Geben Sie eine kurze Erl√§uterung ein',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte erl√§utern Sie den Sachverhalt'
              }
        }
          ],
          completedDataFields: [
            { label: 'Bekannte Umst√§nde, die auf ein anstehendes oder bereits eingeleitetes strafrechtliches Ermittlungsverfahren hinweisen', valueId: 'additionalTrue' },
            { label: 'Erl√§uterung', valueId: 'additionalExplication' }
          ]
        },
        {
          id: 9,
          heading: 'Antragsabschluss',
          icon: 'icn-thumbs-up-outlined',
          isConsentStep: true,
          completedDataFields: [
            { label: 'Zustimmung', valueId: 'newsletter_consent', transform: (val) => val ? 'Ja' : 'Nein' }
          ]
        }
      ],
      providers: [
        {
          id: 'box-1',
          logo: 'img/vattenfall-logo.png',
          name: '√ñkoStrom 12',
          rating: 4.5,
          ratingCount: 11.280,
          price: 33.73,
          pricePeriod: 'Durchschnitt pro Monat',
          details: [
            { label: 'Ihr Verbrauch', value: '1.500 kWh/Jahr' },
            { label: 'Arbeitspreis', value: '27,60 Ct/Jahr' },
            { label: 'Grundpreis', value: '190,80 ‚Ç¨/Jahr' },
            { label: 'Sofortbonus', value: '50,00 ‚Ç¨' },
            { label: 'Verivox Winterpr√§mie', value: '50,00 ‚Ç¨' },
            { label: 'Neukundebonus', value: '100,00 ‚Ç¨' }
          ],
          actionLink: {
            text: 'Preis- und Tarifdetails',
            icon: 'icn-looking-glass-filled'
          },
          drawerConfig: {
            title: 'Preis',
            sections: [
              {
                title: 'Allgemein',
                subsections: [
                    {
                        title: '',
                        items: [
                            { label: 'Deckungsumfang', value: 'Privat Beruf Verkehr (VN) Wohnen Vermietung' },
                            { label: 'Selbstbeteiligung', value: '500 EUR', highlight: false  },
                            { label: 'Deckungssumme', value: 'unbegrenzt' },
                            { label: 'Kautionsdarlehen', value: 'bis zu 1 Mio EUR' },
                            { label: 'K√ºndigungsfristen', value: 'zum Vertragsablauf, K√ºndigungsfrist 3 Monate' }
                        ]
                    },
                    {
                        title: 'Versicherte Personen',
                        items: [
                        { label: 'Versicherungsnehmer', value: 'versichert Sofern Vertragsumfang versichert/vereinbart: Einschluss Wohnen/Vermietung: ‚Ä¢ auch in der Eigenschaft als Eigent√ºmer, Vermieter, Verp√§chter, Mieter, P√§chter, Nutzungsberechtigter' },
                        { label: 'Partner', value: 'versichert Sofern Vertragsumfang versichert/vereinbart: Einschluss Privat/Beruf/Verkehr: Ehe-/Lebenspartner Achtung: ‚Ä¢ die Mitversicherung des Lebenspartners muss beantragt werden ‚Ä¢ Einschluss Beruf bei Senior-Tarifen nicht m√∂glich' },
                        { label: 'Eltern', value: 'versichert Sofern Vertragsumfang versichert/vereinbart: Einschluss Privat/Beruf/Verkehr: ‚Ä¢ Eltern und Gro√üeltern, sofern sich diese im Ruhestand befinden und mit dem VN in h.G. leben. Achtung: die Mitversicherung der Eltern und Gro√üeltern muss beantragt werden.' },
                        { label: 'Gro√üeltern, sonstige Personen', value: 'versichert Sofern Vertragsumfang versichert/vereinbart: Einschluss Privat/Beruf/Verkehr: ‚Ä¢ Eltern und Gro√üeltern, sofern sich diese im Ruhestand befinden und mit dem VN in h.G. leben. Achtung: die Mitversicherung der Eltern und Gro√üeltern muss beantragt werden.' }
                        ]
                    },
                    {
                        title: 'Versicherte T√§tigkeiten',
                        items: [
                        { label: 'Selbstst√§ndige T√§tigkeit der versicherten Person bis zu einem bestimmten Jahresumsatz erlaubt', value: 'nicht versichert' },
                        { label: 'Mitversicherung nebenberuflicher, ehrenamtlicher T√§tigkeiten', value: 'versichert' },
                        { label: 'Vorsorge bei Aufnahme einer freiberuflichen T√§tigkeit', value: 'ohne Wartezeit, versichert' },
                        { label: 'Auslandsaufenthalt zeitlich begrenzt', value: 'im √∂rtlichen Geltungsbereich mitversichert; √úber Spezial-Straf-Rechtsschutz weltweiter Versicherungsschutz' },
                        { label: 'Auslandsdeckung im Beruf', value: 'versichert, im Geltungsbereich ohne zeitliche Begrenzung; weltweit: Urlaubs-, Dienst- oder Gesch√§ftsreise, Work&Travel, Au-pair Aufenthalt; Sch√ºleraustausch oder Auslandsemester bis zu 12 Monate; private Vertr√§ge √ºber das Internet' }
                        ]
                    },
                    {
                        title: 'Anwaltswahl & telefonische Ausk√ºnfte',
                        items: [
                        { label: 'Ent¬≠schei¬≠dung √ºber die De¬≠ckun¬≠gs¬≠zu¬≠sa¬≠ge', value: 'Stichentscheid' },
                        { label: 'Freie Rechts¬≠an¬≠walts¬≠wahl', value: 'ja' },
                        { label: 'Scha¬≠dens¬≠f√§l¬≠le vor Ver¬≠si¬≠che¬≠run¬≠gs¬≠be¬≠ginn', value: 'versichert, sofern betroffenes Risiko seit mind. 5 Jahren ununterbrochen bei der Auxilia mitversichert' },
                        { label: 'Telefonische Erstberatung', value: 'versichert ‚Ä¢ in allen Rechtsschutzangelegenheiten ‚Ä¢ auch Online-Beratung' },
                        { label: 'Te¬≠le¬≠fo¬≠ni¬≠sche An¬≠walts¬≠aus¬≠k√ºnf¬≠te f√ºr nicht ver¬≠si¬≠cher¬≠te Ri¬≠si¬≠ken', value: 'versichert ‚Ä¢ in allen Rechtsschutzangelegenheiten ‚Ä¢ auch Online-Beratung' },
                        { label: 'Te¬≠le¬≠fo¬≠ni¬≠sche An¬≠walts¬≠aus¬≠k√ºnfte f√ºr nicht ver¬≠si¬≠cher¬≠ba¬≠re Ri¬≠si¬≠ken', value: 'nicht versichert' },
                        { label: 'Me¬≠dia¬≠ti¬≠ons¬≠ver¬≠fah¬≠ren (An¬≠zahl und H√∂he der Sit¬≠zun¬≠gen)', value: 'bis zu 3.000 EUR Jahresh√∂chstentsch√§digung max. 6.000 EUR auch f√ºr ausgeschlossene Rechtsangelegenheiten (Mediation XXL)' }
                        ]
                    },
                    {
                        title: 'Leistungsaussagen',
                        items: [
                        { label: 'Leistungsaussagen', value: '' },
                        { label: 'Strafvollstreckungsma√ünahmen', value: 'versichert, ab einer Geldstrafe oder -bu√üe ab 255 EUR' },
                        { label: 'Eherechtschutz', value: 'nicht versichert' },
                        { label: 'Unterhaltsrechtsschutz', value: 'Kosten der anwaltlichen Erstberatung' },
                        { label: 'Innovationsklausel (Bedingungsverbesserungen)', value: 'versichert' },
                        { label: 'Besonderheiten bei Arbeitslosigkeit', value: 'nicht versichert' },
                        { label: 'Kapitalanlagen', value: 'risikoarme Kapitalanlagen: Summe unbegrenzt' },
                        { label: 'Photovoltaikanlagen', value: 'bis zu 20.000 EUR' }
                        ]
                    }
                ]
              },
              {
                title: 'Vertragskonditionen',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Ord¬≠nun¬≠gs¬≠wid¬≠rig¬≠kei¬≠ten-Rechts¬≠schutz', value: 'gerichtlich und au√üergerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Scha¬≠denser¬≠satz-Rechts¬≠schutz', value: 'nicht versichert' },
                        { label: 'Rechts¬≠schutz im Ver¬≠trags- und Sach¬≠recht', value: 'gerichtlich und au√üergerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Straf-Rechts¬≠schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Steu¬≠er-Rechts¬≠schutz vor Ge¬≠rich¬≠ten', value: 'nicht versichert' },
                        { label: 'Ver¬≠wal¬≠tun¬≠gs¬≠rechts¬≠schutz f√ºr Wi¬≠der¬≠spruchs¬≠ver¬≠fah¬≠ren', value: 'nicht versichert' },
                        { label: 'Ver¬≠wal¬≠tun¬≠gs¬≠rechts¬≠schutz (ge¬≠richt¬≠lich)', value: 'ab vorgeschaltetem Widerspruchsverfahren, ohne Wartezeit, Summe unbegrenzt gerichtlich mitversichert' },
                        { label: 'So¬≠zi¬≠al¬≠ge¬≠richts¬≠rechts¬≠schutz f√ºr Wi¬≠der¬≠spruchs¬≠ver¬≠fah¬≠ren', value: 'nicht versichert' },
                        { label: 'So¬≠zi¬≠al¬≠ge¬≠richts¬≠rechts¬≠schutz (ge¬≠richt¬≠lich)', value: 'ab vorgeschaltetem Widerspruchsverfahren, ohne Wartezeit, Summe unbegrenzt gerichtlich mitversichert' },
                        { label: 'Dis¬≠zi¬≠pli¬≠nar- und Stan¬≠des-Rechts¬≠schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Beratung im Familien- und Erbrecht', value: 'ohne Wartezeit, versichert ‚Ä¢ √úber die Beratung hinausgehende T√§tigkeit 1.000 EUR. ‚Ä¢ Auch gerichtliche Auseinandersetzungen in erbrechtlichen Streitigkeiten bis 10.000 EUR pro Vertragslaufzeit. Wartezeit 12 Monate' },
                        { label: 'Gerichtliche Wahrnehmung f√ºr Erbrecht', value: 'Wartezeit 12 Monate, bis zu 10.000 EUR' },
                        { label: 'Rechtsschutz f√ºr Betreuungs- und Vorsogeverf√ºgungen', value: 'ohne Wartezeit, versichert auch anwaltliche T√§tigkeiten √ºber eine Beratung hinaus bis 1.000 EUR' }
                        ]
                    }
                ]
              },
              {
                title: 'Energiequellen',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Ar¬≠beits¬≠rechts¬≠schutz', value: 'Wartezeit 3 Monate, Summe unbegrenzt Die Wartezeit entf√§llt bei einem l√ºckenlosen √úbergang von einem Vorversicherer. auch Aufhebungsvereinbarungen bis 5.000 EUR. Beratung bei arbeitsrechtlichen Angelegenheiten: je Beratung bis 250 EUR, max. 500 EUR je Kalenderjahr' },
                        { label: 'Ar¬≠beits¬≠rechts¬≠schutz bei angedrohter K√ºndigung mit Versicherungsfall', value: 'Wartezeit 3 Monate, Summe unbegrenzt Die Wartezeit entf√§llt bei einem l√ºckenlosen √úbergang von einem Vorversicherer. auch Aufhebungsvereinbarungen bis 5.000 EUR. Beratung bei arbeitsrechtlichen Angelegenheiten: je Beratung bis 250 EUR, max. 500 EUR je Kalenderjahr' },
                        { label: 'Opferrechtsschutz', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenzt auch die T√§tigkeit eines Rechtsanwaltes im Ermittlungs- und Nebenklageverfahren, sowie im Rahmen des T√§ter-Opferausgleiches, ‚Ä¢ auch Anti-Stalking Rechtsschutz; ‚Ä¢ auch au√üergerichtlich' },
                        { label: 'Rechts¬≠schutz f√ºr Auf¬≠he¬≠bun¬≠gs¬≠ver¬≠tr√§¬≠ge', value: 'Wartezeit 3 Monate, Summe unbegrenzt Die Wartezeit entf√§llt bei einem l√ºckenlosen √úbergang von einem Vorversicherer. auch Aufhebungsvereinbarungen bis 5.000 EUR. Beratung bei arbeitsrechtlichen Angelegenheiten: je Beratung bis 250 EUR, max. 500 EUR je Kalenderjahr'}
                        ]
                    }
                ]
              },
              {
                title: 'Anbieter / Bewertung',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Ver¬≠si¬≠cher¬≠te Fahr¬≠zeu¬≠ge', value: 'Alle auf den Versicherungsnehmer zugelassenen motorgetriebene Land-, Wasser- und Luftfahrzeuge sowie deren Anh√§nger Der Versicherungsschutz erstreckt sich auch auf die Wahrnehmung rechtlicher Interessen als Mieter oder P√§chter von Garagen und Kraftfahrzeug-Abstellpl√§tzen.' },
                        { label: 'Fahr¬≠zeu¬≠ge voll¬≠j√§h¬≠ri¬≠ger Kin¬≠der', value: 'versichert (gem√§√ü Familiendefinition)' },
                        { label: 'Ord¬≠nun¬≠gs¬≠wid¬≠rig¬≠kei¬≠ten-Rechts¬≠schutz', value: 'gerichtlich und au√üergerichtlich, ohne Wartezeit, Summe unbegrenzt Auch Mitversicherung eines Firmen-Pkw' },
                        { label: 'Scha¬≠denser¬≠satz-Rechts¬≠schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Rechts¬≠schutz im Ver¬≠trags- und Sach¬≠recht', value: 'gerichtlich und au√üergerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Straf-Rechts¬≠schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Steu¬≠er-Rechts¬≠schutz vor Ge¬≠rich¬≠ten', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenzt auch die T√§tigkeit eines Rechtsanwaltes im Ermittlungs- und Nebenklageverfahren, sowie im Rahmen des T√§ter-Opferausgleiches auch au√üergerichtlich' },
                        { label: 'Ver¬≠wal¬≠tun¬≠gs¬≠rechts¬≠schutz f√ºr Wi¬≠der¬≠spruchs¬≠ver¬≠fah¬≠ren', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenz' },
                        { label: 'Ver¬≠wal¬≠tun¬≠gs¬≠rechts¬≠schutz (ge¬≠richt¬≠lich)', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'So¬≠zi¬≠al¬≠ge¬≠richts¬≠rechts¬≠schutz f√ºr Wi¬≠der¬≠spruchs¬≠ver¬≠fah¬≠ren', value: 'nicht versichert' },
                        { label: 'So¬≠zi¬≠al¬≠ge¬≠richts¬≠rechts¬≠schutz (ge¬≠richt¬≠lich)', value: 'ab vorgeschaltetem Widerspruchsverfahren, ohne Wartezeit, Summe unbegrenzt gerichtlich mitversichert' },
                        { label: 'Opferrechtsschutz', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenzt auch die T√§tigkeit eines Rechtsanwaltes im Ermittlungs- und Nebenklageverfahren, sowie im Rahmen des T√§ter-Opferausgleiches auch au√üergerichtlich' },
                        { label: 'Dis¬≠zi¬≠pli¬≠nar- und Stan¬≠des- Rechts¬≠schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Ver¬≠sto√ü gegen Halte- und Park¬≠vor¬≠schrif¬≠ten', value: 'versichert Erst ab drohender Eintragung in das Fahreignungsregister (FAER)' },
                        { label: 'Ver¬≠si¬≠che¬≠run¬≠gs¬≠schutz bei Ver¬≠ur¬≠tei¬≠lung wegen vor¬≠s√§tz¬≠li¬≠cher Straf¬≠ta¬≠ten im Ver¬≠kehrs¬≠be¬≠reich', value: 'nicht versichert' }
                        ]
                    }
                ]
              },
              {
                title: 'Zusammenfassung',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Ordnungswidrigkeiten-Rechts¬≠schutz', value: 'gerichtlich und au√üergerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Verwaltungs-Rechts¬≠schutz', value: 'gerichtlich, Wartezeit 3 Monate, Summe unbegrenzt Die Wartezeit entf√§llt bei einem l√ºckenlosen √úbergang von einem Vorversicherer' },
                        { label: 'Steuerrechtsschutz', value: 'ab vorgeschaltetem Widerspruchsverfahren, ohne Wartezeit, Summe unbegrenzt ‚Ä¢ gerichtlich mitversichert ‚Ä¢ Einspruchsverfahren mitversichert' },
                        { label: 'Strafrechtschutz', value: 'ohne Wartezeit, Summe unbegrenzt' }
                        ]
                    }
                ]
              },
              {
                title: 'Versicherte Kosten',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Freie Rechts¬≠an¬≠walts¬≠wahl in H√∂he der ge¬≠setz¬≠li¬≠chen Ver¬≠g√º¬≠tung', value: 'ja' },
                        { label: 'Kor¬≠re¬≠spon¬≠denz¬≠an¬≠walt', value: 'bis zu 100 % d. Kosten Bei Rechtsschutzf√§llen im Inland: Alternativ werden die Reisekosten und Abwesenheitsgelder des zust√§ndigen Anwalts √ºbernommen.' },
                        { label: 'Kos¬≠ten der Ge¬≠gen¬≠sei¬≠te', value: 'bis zu 100 % d. Kosten' },
                        { label: 'Kosten und Geb√ºhren f√ºr Zeugen und Sachverst√§ndige', value: 'bis zu 100 % d. Kosten' },
                        { label: '√ñf¬≠fent¬≠lich be¬≠stell¬≠te Sach¬≠ver¬≠st√§n¬≠di¬≠ge', value: 'bis zu 100 % d. Kosten' },
                        { label: 'Rei¬≠se¬≠kos¬≠ten zum deut¬≠schen Ge¬≠richt', value: 'bis zu 100 % d. Kosten Sofern mehr als 100 km vom Gericht entfernt, alternativ die Kosten f√ºr einen Verkehrsanwalt' },
                        { label: 'Rei¬≠se¬≠kos¬≠ten zum aus¬≠l√§n¬≠di¬≠schen Ge¬≠richt', value: 'bis zu 100 % d. Kosten Sofern mehr als 100 km vom Gericht entfernt, alternativ die Kosten f√ºr einen Verkehrsanwalt' }
                        ]
                    }
                ]
              },
              {
                title: 'Spezial-Straf-Rechtsschutz',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Spe¬≠zi¬≠al-Straf-Rechts¬≠schutz', value: 'bis zu 300.000 EUR' },
                        { label: 'De¬≠ckun¬≠gs¬≠sum¬≠me Spe¬≠zi¬≠al-Straf-Rechts¬≠schutz', value: 'nicht versichert' },
                        { label: 'Straf¬≠kau¬≠ti¬≠on', value: 'volle Kosten√ºbernahme Kaution Weltweit bis zu einem Jahr Aufenthalt im Ausland bis 1.000.000 EUR. Auch erweiterte Strafkaution bis 300.000 EUR. Einschlie√ülich Versicherungsschutz trotz Vorsatz bei Erledigung im Wege eines Strafbefehls' },
                        { label: 'Erweiterte Straf¬≠kau¬≠ti¬≠on', value: 'bis zu 300.000 EUR' },
                        { label: 'Privater Bereich', value: 'bis zu 300.000 EUR' },
                        { label: 'Besch√§ftigung als Arbeitnehmer', value: 'bis zu 300.000 EUR' },
                        { label: 'Ehrenamt', value: 'nicht versichert' },
                        { label: 'Verdeckte Ermittlungen', value: 'nicht versichert' },
                        { label: 'Be¬≠son¬≠der¬≠heit Spe¬≠zi¬≠al-Straf-Rechts¬≠schutz', value: 'versichert Es wird eine angemessene Verg√ºtung nach dem RVG z.B. f√ºr Reisekosten des Rechtsanwaltes; Nebenklagekosten und Sachverst√§ndigenkosten √ºbernommen.' },
                        { label: 'Gegnerische Anwaltskosten im Falle des Unterliegens', value: 'bis zu 100 % d. Kosten' }
                        ]
                    }
                ]
              },
              {
                title: 'Beratungsdokumentation',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Beratungsdokumentation', value: 'noch einf√ºgen' }
                        ]
                    }
                ]
              }
            ]
          }
        }
      ]
    };
    // ===== UTILITY FUNCTIONS =====
    function createStarsHTML(rating) {
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 !== 0;
      let html = '';
      for (let i = 0; i < fullStars; i++) {
        html += '<span class="star icn icn-star-filled" aria-hidden="true"></span>';
      }
      if (hasHalfStar) {
        html += '<span class="star icn icn-star-half-filled" aria-hidden="true"></span>';
      }
      return html;
    }
    function createDetailItemHTML(detail) {
      return `
        <div class="detail-item">
          <span class="detail-label">${detail.label}</span>
          <span class="detail-value">${detail.value}</span>
        </div>
      `;
    }
    function createFormFieldHTML(field) {
  const labelHTML = `
    <label for="${field.id}">
      <span class="label-text">${field.label}${field.required ? ' *' : ''}</span>
      <span class="info-icon icn icn-info-circle-filled" aria-hidden="true"></span>
    </label>
  `;
  if (field.type === 'select') {
    const optionsHTML = field.options
      .map(opt => `<option value="${opt.value}">${opt.label}</option>`)
      .join('');
    return `
      <div class="form-group">
        ${labelHTML}
        <ds-select id="${field.id}" ${field.required ? 'required' : ''}>
          ${optionsHTML}
        </ds-select>
      </div>
    `;
  } else if (field.type === 'input') {
    return `
      <div class="form-group">
        ${labelHTML}
        <ds-input
          id="${field.id}"
          type="${field.inputType || 'text'}"
          placeholder="${field.placeholder || ''}"
          ${field.step ? `step="${field.step}"` : ''}
          ${field.required ? 'required' : ''}
          ${field.disabled ? 'disabled' : ''}
          ${field.valid ? 'valid' : ''}
        ></ds-input>
      </div>
    `;
  } else if (field.type === 'date') {
    return `
      <div class="form-group">
        ${labelHTML}
        <ds-date-picker
          id="${field.id}" ${field.required ? 'required' : ''}>
        </ds-date-picker>
      </div>
    `;
  } else if (field.type === 'selectText') {
    return `
      <div class="form-group">
        ${labelHTML}
        <ds-select-text
          id="${field.id}" ${field.required ? 'required' : ''}>
        </ds-select-text>
      </div>
    `;
  }
}

    // ===== STORAGE MANAGER =====
    class StorageManager {
      static saveFormData(data) {
        try {
          localStorage.setItem('verivox_checkout_data', JSON.stringify(data));
          console.log('‚úì Form data saved to LocalStorage');
        } catch (e) {
          console.error('LocalStorage save error:', e);
        }
      }
      static loadFormData() {
        try {
          const data = localStorage.getItem('verivox_checkout_data');
          return data ? JSON.parse(data) : null;
        } catch (e) {
          console.error('LocalStorage load error:', e);
          return null;
        }
      }
      static saveCheckoutState(state) {
        try {
          localStorage.setItem('verivox_checkout_state', JSON.stringify(state));
          console.log('‚úì Checkout state saved:', state);
        } catch (e) {
          console.error('LocalStorage state save error:', e);
        }
      }
      static loadCheckoutState() {
        try {
          const state = localStorage.getItem('verivox_checkout_state');
          return state ? JSON.parse(state) : null;
        } catch (e) {
          console.error('LocalStorage state load error:', e);
          return null;
        }
      }
      static clear() {
        try {
          localStorage.removeItem('verivox_checkout_data');
          localStorage.removeItem('verivox_checkout_state');
          console.log('‚úì LocalStorage cleared');
          location.reload();
        } catch (e) {
          console.error('LocalStorage clear error:', e);
        }
      }
      static hasData() {
        return localStorage.getItem('verivox_checkout_data') !== null;
      }
    }
    // ===== STEPS MANAGER =====
    class StepsManager {
      constructor(config) {
        this.config = config;
        this.init();
      }
      init() {
        this.renderSteps();
        console.log(`‚úì StepsManager initialized with ${this.config.length} steps`);
        //this.setViewMode();
      }
      renderSteps() {
        const dsProgressWrapper = document.querySelector('.progress-wrapper');
        const dsStepsElement = document.createElement('ds-steps');
          dsStepsElement.setAttribute('id', 'checkoutSteps');
            dsStepsElement.setAttribute('interactive', '');
          dsStepsElement.setAttribute('current', '1');
          dsStepsElement.setAttribute('current', '1');
          dsStepsElement.setAttribute('complete', '1');
        this.config.forEach(step => {
          const stepElement = document.createElement('ds-step');
          stepElement.setAttribute('heading', step.heading);
          stepElement.setAttribute('step-id', `step-${step.id}`);
          dsStepsElement.appendChild(stepElement);
        });
        dsProgressWrapper.appendChild(dsStepsElement);
      }
      setViewMode() {
        const dsStepsElement = document.getElementById('checkoutSteps');
        const stepCount = this.config.length;
        console.log(`Total steps: ${stepCount}`);
        if (stepCount <= 5) {
          dsStepsElement.removeAttribute('view-mode');
          console.log('‚úì View mode: Circle (default)');
        } else {
          dsStepsElement.setAttribute('view-mode', 'bar');
          console.log('‚úì View mode: Bar');
        }
      }
    }

    // ===== NEUER CODE F√úR LAYOUT-RENDERING =====
function renderFormFields(stepConfig) {
  let html = '';
  // Wenn layout definiert ist, nutze das
  if (stepConfig.layout && stepConfig.layout.length > 0) {
    stepConfig.layout.forEach(row => {
      if (row.type === 'row') {
        html += `<div class="form-row columns-${row.columns}">`;
        row.fields.forEach(fieldId => {
          const field = stepConfig.fields.find(f => f.id === fieldId);
          if (field) {
            html += createFormFieldHTML(field);
          }
        });
        html += '</div>';
      }
    });
  } else {
    // Fallback: Alle Felder einzeln
    stepConfig.fields.forEach(field => {
      html += `<div class="form-row columns-1">`;
      html += createFormFieldHTML(field);
      html += '</div>';
    });
  }
  return html;
}

    // ===== CHECKOUT STEPS RENDERER =====
    class CheckoutStepsRenderer {
      constructor(config) {
        this.config = config;
        this.init();
      }
      init() {
        this.renderSteps();
        console.log(`‚úì Rendered ${this.config.length} checkout step cards`);
      }
      renderSteps() {
        const container = document.getElementById('checkoutSteps-container');
        container.innerHTML = '';
        this.config.forEach(step => {
          const stepCard = this.createStepCard(step);
          container.appendChild(stepCard);
        });
      }
      createStepCard(step) {
        const card = document.createElement('div');
        card.className = 'step-card editing scroll-target';
        card.dataset.step = step.id;
        if (step.isConsentStep) {
  card.innerHTML = `
    <ds-ribbon variant="success" position="top-left">
      <span class="icn icn-check-circle-filled" aria-hidden="true"></span>

    </ds-ribbon>
    <div class="step-header">
      <div class="step-header-left">
        <div class="step-icon icn ${step.icon}" aria-hidden="true"></div>
        <div class="step-title">
          <h2>${step.heading}</h2>
          <span class="step-subtitle" id="subtitle-${step.id}"></span>
        </div>
      </div>
      <div class="step-header-right" id="header-action-${step.id}"></div>
    </div>
    <div class="step-content">
      <form class="step-form" id="form-${step.id}" novalidate>
        <div class="consent-section">
          <div class="consent-checkbox-wrapper">
            <ds-checkbox
              id="newsletter-checkbox"
              value="newsletter"
              name="newsletter-consent"
              aria-describedby="newsletter-text"
            ></ds-checkbox>
            <div class="consent-text" id="newsletter-text">
                Ja, ich m√∂chte kostenlos von Verivox √ºber deren jeweilige <a class="inlinelink" href="#" onclick="openTestModeModal(); return false;" data-auto-event-observed="true">Angebote</a> und im geringen Umfang auch √ºber besondere Angebote ausgew√§hlter Partner mittels personalisierter elektronischer Post (z.B. E-Mail, SMS, WhatsApp) informiert werden. Ich stimme der aggregierten Nutzungsanalyse (√ñffnungen und Klicks) zu. Diese Einwilligung kann ich jederzeit mit Wirkung f√ºr die Zukunft widerrufen (E-Mail an service@verivox.de) ohne dass hierf√ºr andere als √úbermittlungskosten nach Basistarif entstehen. Weitere Infos hier: <a class="inlinelink" href="#" onclick="openTestModeModal(); return false;" data-auto-event-observed="true">Datenschutzhinweise</a>
            </div>
          </div>
          <div class="newsletter-error" id="newsletter-error"></div>
        </div>
        <div class="disclaimer-text">
            Mit Klick auf ‚ÄûKAUF ABSCHLIESSEN" erkl√§re ich mich mit den <a href="#" onclick="openTestModeModal(); return false;">AGB</a> und der <a href="#" onclick="openTestModeModal(); return false;">Beratungsdokumentation</a> der Verivox Versicherungsvergleich GmbH einverstanden und nehme die <a href="#" onclick="openTestModeModal(); return false;">Datenschutzerkl√§rung</a> zur Kenntnis. Des Weiteren best√§tige ich, die zu den <a href="#" onclick="openTestModeModal(); return false;">Vertragsbedingungen des Versicherers</a> geh√∂rigen Dokumente heruntergeladen zu haben und erkl√§re mich mit deren Inhalt einverstanden.
        </div>

      </form>
    </div>
    <div class="step-completed-content">
      <div class="completed-data">
        <div class="completed-data-row">
          <div class="data-item">
            <span class="data-label">Zustimmung</span>
            <span class="data-value" id="completed-newsletter_consent">-</span>
          </div>
        </div>
      </div>
    </div>
  `;
} else {
            card.innerHTML = `
      <ds-ribbon variant="success" position="top-left">
        <span class="icn icn-check-circle-filled" aria-hidden="true"></span>
      </ds-ribbon>
      <div class="step-header">
        <div class="step-header-left">
          <div class="step-icon icn ${step.icon}" aria-hidden="true"></div>
          <div class="step-title">
            <h2>${step.heading}</h2>
            <span class="step-subtitle" id="subtitle-${step.id}"></span>
          </div>
        </div>
        <div class="step-header-right" id="header-action-${step.id}"></div>
      </div>
      <div class="step-content">
        <form class="step-form" id="form-${step.id}" novalidate>
          ${renderFormFields(step)}
          <div class="form-actions">
            <ds-button text="${step.id === this.config.length ? 'Abschlie√üen' : 'Weiter'}" appearance="primary" full-width data-step="${step.id}" data-action="next" class="btn-action" type="button" ${step.id === this.config.length ? 'icon-right="check-filled"' : ''}></ds-button>
          </div>
        </form>
      </div>
      <div class="step-completed-content">
        <div class="completed-data">
          ${this.renderCompletedDataTemplate(step)}
        </div>
      </div>
    `;
  }
        return card;
      }
      renderCompletedDataTemplate(step) {
        const rows = [];
        const fields = step.completedDataFields;
        for (let i = 0; i < fields.length; i += 2) {
          let rowHTML = '<div class="completed-data-row">';
          const field1 = fields[i];
          rowHTML += `
            <div class="data-item">
              <span class="data-label">${field1.label}</span>
              <span class="data-value" id="completed-${field1.valueId || field1.valueIds?.[0] || ''}"></span>
            </div>
          `;
          if (fields[i + 1]) {
            const field2 = fields[i + 1];
            rowHTML += `
              <div class="data-item">
                <span class="data-label">${field2.label}</span>
                <span class="data-value" id="completed-${field2.valueId || field2.valueIds?.[0] || ''}"></span>
              </div>
            `;
          }
          rowHTML += '</div>';
          rows.push(rowHTML);
        }
        return rows.join('');
      }
    }
    // ===== CONDITIONAL FIELD VISIBILITY =====
class ConditionalFieldManager {
  constructor(checkoutManager) {
    this.checkoutManager = checkoutManager;
    this.init();
  }

  init() {
    this.setupConditionalFields();
    console.log('‚úì ConditionalFieldManager initialized');
  }

  setupConditionalFields() {
    // Step 8: additionalExplication abh√§ngig von additionalTrue
    const additionalTrueSelect = document.getElementById('additionalTrue');
    const additionalExplicationField = document.getElementById('additionalExplication')?.closest('.form-group');

    if (additionalTrueSelect && additionalExplicationField) {
      // Initial state setzen
      this.updateAdditionalExplicationVisibility(additionalTrueSelect, additionalExplicationField);

      // Event Listener f√ºr √Ñnderungen
      additionalTrueSelect.addEventListener('change', (e) => {
        this.updateAdditionalExplicationVisibility(additionalTrueSelect, additionalExplicationField);
      });

      console.log('‚úì Conditional field visibility set up for Step 8');
    }
  }

  updateAdditionalExplicationVisibility(selectElement, fieldElement) {
    const value = selectElement.value;

    // Zeige das Feld nur wenn "ja" ausgew√§hlt ist
    if (value === 'ja') {
      fieldElement.style.display = 'flex';
      fieldElement.style.animation = 'slideDown 0.3s ease';
      // Mache das Feld required wenn sichtbar
      const input = fieldElement.querySelector('ds-input');
      if (input) input.setAttribute('required', 'required');
      console.log('‚úì additionalExplication Feld angezeigt');
    } else {
      fieldElement.style.display = 'none';
      // Entferne required wenn versteckt
      const input = fieldElement.querySelector('ds-input');
      if (input) {
        input.removeAttribute('required');
        input.value = ''; // Clear the value
      }
      console.log('‚úì additionalExplication Feld verborgen');
    }
  }
}

// ===== DATE FORMATTER =====
class DateFormatter {
    constructor() {
        this.init();
    }

    init() {
        this.setupDateFormatting();
        console.log('‚úì DateFormatter initialized');
    }

    setupDateFormatting() {
        const dateInput = document.getElementById('startIns')

        if (dateInput) {
            // Event Listener f√ºr Input
      dateInput.addEventListener('input', (e) => {
        this.formatDate(dateInput);
      });
      // Event Listener f√ºr Paste
      dateInput.addEventListener('paste', (e) => {
        setTimeout(() => {
          this.formatDate(dateInput);
        }, 10);
      });

      console.log('‚úì Date formatting set up');

        }

    }

    formatDate(inputElement) {
    // Entferne alle nicht-Ziffern
    let value = inputElement.value.replace(/\D/g, '');

    // Begrenzte auf max 8 Zeichen (DDMMYYYY)
    value = value.substring(0, 8);

    // Formatiere als TT.MM.JJJJ
    let formatted = '';
    if (value.length > 0) {
      formatted += value.substring(0, 2);  // TT
    }
    if (value.length > 2) {
      formatted += '.' + value.substring(2, 4);  // MM
    }
    if (value.length > 4) {
      formatted += '.' + value.substring(4, 8);  // JJJJ
    }

    inputElement.value = formatted;
    console.log(`Date formatted: ${formatted}`);
  }
}

// ===== IBAN FORMATTER =====
class IBANFormatter {
  constructor() {
    this.init();
  }

  init() {
    this.setupIBANFormatting();
    console.log('‚úì IBANFormatter initialized');
  }

  setupIBANFormatting() {
    const ibanInput = document.getElementById('iban');

    if (ibanInput) {
      // Event Listener f√ºr Input
      ibanInput.addEventListener('input', (e) => {
        this.formatIBAN(ibanInput);
      });

      // Event Listener f√ºr Paste
      ibanInput.addEventListener('paste', (e) => {
        setTimeout(() => {
          this.formatIBAN(ibanInput);
        }, 10);
      });

      console.log('‚úì IBAN formatting set up');
    }
  }

  formatIBAN(inputElement) {
    // Entferne alle Leerzeichen und konvertiere zu Gro√übuchstaben
    let value = inputElement.value.replace(/\s+/g, '').toUpperCase();

    // Nur erlaubte Zeichen (Buchstaben und Zahlen)
    value = value.replace(/[^A-Z0-9]/g, '');

    // Begrenze auf max. 34 Zeichen (l√§ngste IBAN)
    value = value.substring(0, 34);

    // Formatiere mit Leerzeichen nach jeder 4. Stelle
    const formatted = value.replace(/(.{4})/g, '$1 ').trim();

    // Setze den formatierten Wert
    inputElement.value = formatted;

    console.log(`IBAN formatted: ${formatted}`);
  }
}
    // ===== PROVIDER BOX MANAGER =====
    class ProviderBoxManager {
      constructor(config, index) {
        this.config = config;
        this.index = index;
        this.boxId = config.id || `box-${index}`;
        this.init();
      }
      init() {
        this.renderBox();
        this.attachEventListeners();
        console.log(`‚úì Provider Box "${this.config.name}" initialized`);
      }
      renderBox() {
        const wrapper = document.getElementById('providerBoxesWrapper');
        const boxHTML = `
          <div class="provider-box-item">
            <div class="provider-box">
                <div class="provider-offer">
                    <div class="provider-header">
                        <div class="provider-logo">
                            <img src="${this.config.logo}" alt="${this.config.name}" />
                        </div>
                        <div class="provider-info">
                            <div class="provider-name">${this.config.name}</div>
                            <div class="provider-rating">
                                <div class="stars">
                                    ${createStarsHTML(this.config.rating)}
                                </div>
                                <span>${this.config.rating}</span>
                            </div>
                        </div>
                    </div>
                    <div class="price-section">
                        <div class="price-value">
                            <div class="price-amount">
                                <span>${this.config.price.toFixed(2)}</span>
                                <span class="price-currency">‚Ç¨</span>
                            </div>
                        </div>
                    <div class="price-help">
                        <span>${this.config.pricePeriod}</span>
                        <span class="icn icn-info-circle-filled" aria-hidden="true"></span>
                    </div>
                </div>
              </div>
              <div class="details-section">
                ${this.config.details.map(detail => createDetailItemHTML(detail)).join('')}
              </div>
              <button type="button" class="action-link open-drawer-btn" data-box-id="${this.boxId}" aria-label="${this.config.actionLink.text} f√ºr ${this.config.name} anzeigen">
                <span class="icn ${this.config.actionLink.icon}" aria-hidden="true"></span>
                <span>${this.config.actionLink.text}</span>
              </button>
            </div>
            <!-- ===== VERTRAGSDOKUMENTE BOX ===== -->
            <div class="provider-box-item">
              <div class="provider-box documents-box">
                <!-- Header mit Icon und Titel -->
                <div class="documents-header">
                  <span class="step-icon icn icn-document-outlined" aria-hidden="true"></span>
                  <h3 class="documents-title">Vertragsdokumente</h3>
                </div>
                <!-- Info Box -->
                <div class="info-box">
                  <span class="info-box-icon icn icn-info-filled" aria-hidden="true"></span>
                  <span class="info-box-name">Sie erhalten alle Dokumente auch in ihrer Best√§tigungsmail.</span>
                </div>
                <!-- Dokument Liste -->
                <div class="documents-list">
                  <div class="document-item">
                    <span class="documents-list-title">Alle Dokumente herunterladen (3)</span>
                    <a href="#" onclick="openTestModeModal(); return false;" class="download-link" aria-label="Alle Dokumente herunterladen" download>
                      <span class="icn icn-download-filled" aria-hidden="true"></span>
                    </a>
                  </div>
                  <!-- Einzelne Dokumente -->
                  <div class="document-item">
                    <span class="icn icn-paperclip-outlined document-icon" aria-hidden="true"></span>
                    <span class="document-name">Belehrung und Widerrufsrecht.pdf</span>
                    <a href="#" onclick="openTestModeModal(); return false;" class="download-link" aria-label="Belehrung und Widerrufsrecht.pdf herunterladen" download>
                      <span class="icn icn-download-filled" aria-hidden="true"></span>
                    </a>
                  </div>
                  <div class="document-item">
                    <span class="icn icn-paperclip-outlined document-icon" aria-hidden="true"></span>
                    <span class="document-name">asspario_flyer_privathaftpflicht.pdf</span>
                    <a href="#" onclick="openTestModeModal(); return false;" class="download-link" aria-label="asspario_flyer_privathaftpflicht.pdf herunterladen" download>
                      <span class="icn icn-download-filled" aria-hidden="true"></span>
                    </a>
                  </div>
                  <div class="document-item">
                    <span class="icn icn-paperclip-outlined document-icon" aria-hidden="true"></span>
                    <span class="document-name">Assaprio_AVB.pdf</span>
                    <a href="#" onclick="openTestModeModal(); return false;" class="download-link" aria-label="Assaprio_AVB.pdf herunterladen" download>
                      <span class="icn icn-download-filled" aria-hidden="true"></span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        wrapper.insertAdjacentHTML('beforeend', boxHTML);
      }
      attachEventListeners() {
        const btn = document.querySelector(`[data-box-id="${this.boxId}"]`);
        if (btn) {
          btn.addEventListener('click', (e) => {
            e.preventDefault();
            this.openDrawer();
          });
        }
      }
      openDrawer() {
        console.log(`Opening drawer for ${this.config.name}`);
        this.renderDrawer();
        const drawer = document.getElementById('tariffDrawer');
        const overlay = document.getElementById('drawerOverlay');
        drawer.classList.add('open');
        overlay.classList.add('open');
        document.body.style.overflow = 'hidden';
      }
      renderDrawer() {
        //const drawerTitle = document.getElementById('drawerTitle');
        const drawerProviderContent = document.getElementById('drawerProviderOffer');
        const providerOfferHTML = `
        <div class="provider-header">
            <div class="provider-logo">
                <img src="${this.config.logo}" alt="${this.config.name}" />
            </div>
            <div class="provider-info">
                <div class="provider-name">${this.config.name}</div>
                <div class="provider-rating">
                    <div class="stars">
                        ${createStarsHTML(this.config.rating)}
                    </div>
                    <span>${this.config.rating}</span>
                </div>
            </div>
        </div>
        <div class="price-section">
            <div class="price-value">
                <div class="price-amount">
                    <span>${this.config.price.toFixed(2)}</span>
                    <span class="price-currency">‚Ç¨</span>
                </div>
            </div>
        <div class="price-help">
            <span>${this.config.pricePeriod}</span>
            <span class="icn icn-info-circle-filled" aria-hidden="true"></span>
        </div>
        `;
        drawerProviderContent.innerHTML = providerOfferHTML;
        const drawerContent = document.getElementById('drawerContent');
        //drawerTitle.textContent = this.config.drawerConfig.title;
        const sectionsHTML = `
            <ds-tab-group  variant="line">
                ${this.config.drawerConfig.sections
              .map((section) => {
                return `
                <ds-tab label="${section.title}">
                    <div class="drawer-section-content">
            ${section.subsections.map(subsections => `
            <div class="drawer-subsection-item">
            <div class="drawer-subsection-item-label">${subsections.title}</div>
                                    ${subsections.items.map(item => `
                                        <div class="drawer-list-item ${item.highlight ? 'highlight' : ''}">
                                            <div class="drawer-item-label">${item.label}</div>
                                            <div class="drawer-item-value">${item.value}</div>
                                        </div>
                                        `).join('')}
                </div>
                        `).join('')}
                        </div>
                </ds-tab>
                `;
                })
              .join('')}
            </ds-tab-group>
            <!--- VARIANT ACCORDION
          <ds-accordion>
            ${this.config.drawerConfig.sections
              .map((section) => {
                return `
                  <ds-accordion-item heading="${section.title}">
                    <div class="drawer-section-content">
            ${section.subsections.map(subsections => `
            <div class="drawer-subsection-item">
            <div class="drawer-subsection-item-label">${subsections.title}</div>
                                    ${subsections.items.map(item => `
                                        <div class="drawer-list-item ${item.highlight ? 'highlight' : ''}">
                                            <div class="drawer-item-label">${item.label}</div>
                                            <div class="drawer-item-value">${item.value}</div>
                                        </div>
                                        `).join('')}
                </div>
                        `).join('')}
                        </div>
                    </ds-accordion-item>
                    `;
                })
              .join('')}
          </ds-accordion>-->
        `;
        drawerContent.innerHTML = sectionsHTML;
      }
    }
    // ===== DRAWER MANAGER =====
    class DrawerManager {
      constructor() {
        this.drawer = document.getElementById('tariffDrawer');
        this.overlay = document.getElementById('drawerOverlay');
        this.closeBtn = document.getElementById('closeDrawer');
        this.init();
      }
      init() {
        this.closeBtn.addEventListener('click', () => this.close());
        this.overlay.addEventListener('click', () => this.close());
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') this.close();
        });
        console.log('‚úì DrawerManager initialized');
      }
      close() {
        this.drawer.classList.remove('open');
        this.overlay.classList.remove('open');
        document.body.style.overflow = '';
        console.log('Drawer closed');
      }
    }

    // ===== TOAST NOTIFICATION MANAGER =====
class ToastManager {
  constructor() {
    this.toastContainer = null;
    this.init();
  }

  init() {
    this.createToastContainer();
    console.log('‚úì ToastManager initialized');
  }

  createToastContainer() {
    // Pr√ºfe ob Container bereits existiert
    if (document.getElementById('toast-container')) {
      this.toastContainer = document.getElementById('toast-container');
      return;
    }

    // Erstelle Container
    const container = document.createElement('div');
    container.id = 'toast-container';
    container.style.cssText = `
      position: fixed;
      bottom: 15vh;
      left: 0;
      right: 0;
      display: flex;
      z-index: 3000;

      justify-content: center;
      flex-direction: column;
      gap: var(--ds-spacing-xxs, 8px);
      max-width: 400px;
      align-items: center;
      padding: 0 var(--ds-spacing-m);
    `;
    document.body.appendChild(container);
    this.toastContainer = container;
  }

  showToast(message, type = 'info', duration = 5000) {
    const toast = document.createElement('div');
    const toastId = `toast-${Date.now()}`;
    toast.id = toastId;

    // Style basierend auf Typ
    const styles = {
      info: {
        background: 'var(--ds-background-info-light, #E3F2FD)',
        border: '1px solid var(--ds-border-info, #2196F3)',
        color: 'var(--ds-font-text-info, #1976D2)'
      },
      success: {
        background: 'var(--ds-background-success-light, #E8F5E9)',
        border: '1px solid var(--ds-border-success-regular, #4CAF50)',
        color: 'var(--ds-font-text-success-regular, #2E7D32)'
      },
      warning: {
        background: 'var(--ds-background-warning, #FCF5B8)',
        border: 'var(--ds-stroke-m) solid var(--ds-border-warning, #F5DD14)',
        borderLeft: 'var(--ds-stroke-xl) solid var(--ds-border-warning, #F5DD14)',
        color: 'var(--ds-font-text-warning, #625808)'
      },
      danger: {
        background: 'var(--ds-background-danger-light, #FFEBEE)',
        border: '1px solid var(--ds-border-danger-regular, #F44336)',
        color: 'var(--ds-font-text-danger-regular, #C62828)'
      }
    };

    const style = styles[type] || styles.info;

    toast.style.cssText = `
      padding: var(--ds-spacing-xs, 16px);
      border-radius: var(--ds-radius-xl, 5px);
      font-size: var(--ds-font-size-m, 16px);
      font-weight: var(--ds-font-weight-m, 400);
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs, 16px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      animation: slideInUp 0.3s ease;
      background: ${style.background};
      border: ${style.border};
      border-left: ${style.borderLeft};
      color: ${style.color};
    `;

    // Icon basierend auf Typ
    const icons = {
      info: 'icn-info-circle-filled',
      success: 'icn-check-circle-filled',
      warning: 'icn-warning-filled',
      danger: 'icn-close-circle-filled'
    };

    const icon = icons[type] || icons.info;

    toast.innerHTML = `
      <span class="icn ${icon}" aria-hidden="true" style="flex-shrink: 0; font-size: 20px;"></span>
      <span style="flex: 1;">${message}</span>
      <button type="button" class="toast-close" aria-label="Toast schlie√üen" style="
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        color: inherit;
        font-size: 20px;
        flex-shrink: 0;
        transition: opacity 0.2s;
      ">
        <span class="icn icn-close-outlined" aria-hidden="true"></span>
      </button>
    `;

    // Close Button
    toast.querySelector('.toast-close').addEventListener('click', () => {
      this.removeToast(toastId);
    });

    // F√ºge zum Container hinzu
    this.toastContainer.appendChild(toast);

    // Auto-Remove nach duration
    setTimeout(() => {
      this.removeToast(toastId);
    }, duration);

    console.log(`‚úì Toast shown: ${type} - ${message}`);
  }

  removeToast(toastId) {
    const toast = document.getElementById(toastId);
    if (toast) {
      toast.style.animation = 'slideOutDown 0.3s ease';
      setTimeout(() => {
        toast.remove();
      }, 150);
    }
  }
}

    // ===== CHECKOUT MANAGER =====
class CheckoutManager {
  constructor(config) {
    this.config = config;
    this.currentStep = 1;
    this.formData = {};
    this.completedSteps = []; // NEUER ARRAY f√ºr bereits besuchte Steps
    this.stepStartTime = Date.now();
    this.checkoutStartTime = Date.now();
    this.dsStepsElement = null;
  }
  init() {
    console.log('Initializing CheckoutManager');
    if (window.customElements) {
      customElements.whenDefined('ds-steps').then(() => {
        console.log('ds-steps loaded');
        this.dsStepsElement = document.getElementById('checkoutSteps');
        this.loadFromStorage();
        this.attachEventListeners();
        this.setupRealTimeValidation();
        this.updateProgressBar();
        this.updateStorageStatus();
        this.attachDsStepsEventListeners();
        this.refreshAllStepStates();
      });
    }
  }
  loadFromStorage() {
    // Zuerst Test-Daten laden wenn USE_TEST_DATA aktiviert ist
    if (USE_TEST_DATA) {
      this.formData = TEST_DATA;
      console.log('‚úì Loaded TEST DATA:', this.formData);
      // Setze auch die completedSteps f√ºr die vorbef√ºllten Steps
      this.completedSteps = Object.keys(TEST_DATA).map(k => parseInt(k));
      this.currentStep = Math.min(...this.completedSteps) + 1 || 1;
      // Falls letzter Step, stay auf dem letzten
      if (this.currentStep > this.config.steps.length) {
        this.currentStep = this.config.steps.length;
      }
    }
    // Dann von Storage laden (√ºberschreibt Test-Daten wenn vorhanden)
    const savedData = StorageManager.loadFormData();
    const savedState = StorageManager.loadCheckoutState();
    if (savedData) {
      this.formData = savedData;
      console.log('‚úì Loaded form data from storage:', this.formData);
    }
    if (savedState) {
      this.currentStep = savedState.currentStep;
      this.completedSteps = savedState.completedSteps || [];
      console.log('‚úì Loaded checkout state from storage, currentStep:', this.currentStep, 'completedSteps:', this.completedSteps);
    }
    // Populate Formularfelder mit Daten
    Object.entries(this.formData).forEach(([stepId, data]) => {
      Object.entries(data).forEach(([fieldId, value]) => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.value = value;
        }
      });
    });
  }
  updateStorageStatus() {
    const hasData = StorageManager.hasData() || USE_TEST_DATA;
    const statusEl = document.getElementById('storage-status');
    if (statusEl) {
      statusEl.textContent = hasData ? 'Daten gespeichert' : 'Keine Daten';
    }
  }
  setupRealTimeValidation() {
    console.log('Setting up real-time validation');
    document.querySelectorAll('ds-input').forEach(input => {
      input.addEventListener('input', (e) => {
        this.validateField(input);
        this.autoSaveFormData();
      });
      input.addEventListener('change', (e) => {
        this.validateField(input);
        this.autoSaveFormData();
      });
    });
    document.querySelectorAll('ds-select').forEach(select => {
      select.addEventListener('change', (e) => {
        this.validateField(select);
        this.autoSaveFormData();
      });
    });
  }
  validateField(input) {
    const fieldId = input.id;
    const stepCard = input.closest('.step-card');
    if (!stepCard) return;
    const stepId = parseInt(stepCard.dataset.step);
    const stepConfig = this.config.steps.find(s => s.id === stepId);
    const fieldConfig = stepConfig.fields.find(f => f.id === fieldId);
    if (!fieldConfig || !fieldConfig.validation) return;
    const value = input.value;
    if (!value) {
      input.valid = false;
      input.invalid = false;
      input.errorMessage = '';
      return;
    }
    const isValid = fieldConfig.validation.validate(value);
    if (isValid) {
      input.valid = true;
      input.invalid = false;
      input.errorMessage = '';
    } else {
      input.valid = false;
      input.invalid = true;
      input.errorMessage = fieldConfig.validation.error;
    }
  }
  autoSaveFormData() {
    clearTimeout(this.saveTimeout);
    this.saveTimeout = setTimeout(() => {
      this.collectFormData(this.currentStep);
      StorageManager.saveFormData(this.formData);
      this.updateStorageStatus();
      console.log('‚úì Auto-saved form data');
    }, 1000);
  }
  attachDsStepsEventListeners() {
    this.dsStepsElement.addEventListener('dsStepClick', (e) => {
      const stepNumber = e.detail;
      console.log('ds-step clicked:', stepNumber);
      if (this.currentStep !== stepNumber) {
        this.handleStepClick(stepNumber);
      }
    });
    this.dsStepsElement.addEventListener('dsNavigationClick', (e) => {
      const direction = e.detail;
      console.log('Navigation clicked:', direction);
      if (direction === 1) {
        this.handleNext(this.currentStep);
      } else if (direction === -1) {
        this.handlePrev(this.currentStep);
      }
    });
  }
  attachEventListeners() {
    console.log('Attaching event listeners');
    document.querySelectorAll('ds-button[data-action]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const step = parseInt(btn.dataset.step);
        const action = btn.dataset.action;
        console.log(`Button clicked: step ${step}, action ${action}`);
        if (action === 'next') {
          this.handleNext(step);
        } else if (action === 'prev') {
          this.handlePrev(step);
        }
      });
    });
    document.getElementById('clear-storage').addEventListener('click', (e) => {
      e.preventDefault();
      if (confirm('Sollen alle gespeicherten Daten wirklich gel√∂scht werden?')) {
        StorageManager.clear();
      }
    });
  }
  attachChangeLinks() {
    document.querySelectorAll('.change-button-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const step = parseInt(link.dataset.step);
        console.log(`Change link clicked: step ${step}`);
        this.handleEdit(step);
      });
    });
  }
  collectFormData(step) {
    const form = document.querySelector(`#form-${step}`);
    if (!form) return;
    const inputs = form.querySelectorAll('ds-input, ds-select');
    const data = {};
    inputs.forEach(input => {
      data[input.id] = input.value;
    });
    const checkbox = form.querySelector('ds-checkbox');
    if (checkbox) {
      data['newsletter_consent'] = checkbox.checked;
    }
    if (!this.formData[step]) {
      this.formData[step] = {};
    }
    this.formData[step] = data;
  }
  validateStep(step) {
  const form = document.querySelector(`#form-${step}`);
  if (!form) return false;
  const stepConfig = this.config.steps.find(s => s.id === step);

  if (stepConfig.isConsentStep) {
    const checkbox = form.querySelector('ds-checkbox');
    const errorContainer = document.getElementById('newsletter-error');

    if (!checkbox || !checkbox.checked) {
      // Zeige Error Message unter dem Text
      if (errorContainer) {
        errorContainer.textContent = 'Bitte best√§tigen Sie die Bedingungen, um den Kauf abzuschlie√üen';
        errorContainer.style.display = 'block';
      }

      checkbox.invalid = true;
      console.log('‚úó Checkbox validation failed');

      // Scroll zur Checkbox
      setTimeout(() => {
        checkbox.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 100);

      return false;
    } else {
      // Entferne error message wenn checked
      if (errorContainer) {
        errorContainer.textContent = '';
        errorContainer.style.display = 'none';
      }
      checkbox.invalid = false;
    }
    return true;
  }

  let isValid = true;
  form.querySelectorAll('ds-input[required], ds-select[required]').forEach(input => {
    const fieldId = input.id;
    const fieldConfig = stepConfig.fields.find(f => f.id === fieldId);
    if (!fieldConfig || !input.value || !fieldConfig.validation.validate(input.value)) {
      input.invalid = true;
      input.errorMessage = fieldConfig ? fieldConfig.validation.error : 'Dieses Feld ist erforderlich';
      isValid = false;
    } else {
      input.invalid = false;
    }
  });

  if (!isValid) {
    console.log('Bitte f√ºllen Sie alle erforderlichen Felder korrekt aus.');
  }

  return isValid;
}
  // ===== KORREKTE METHODE MIT COMPLETED-TRACKING =====
  refreshAllStepStates() {
    console.log('Refreshing all step states, currentStep:', this.currentStep, 'completedSteps:', this.completedSteps);
    // Zuerst alle Classes entfernen
    document.querySelectorAll('.step-card').forEach(card => {
      card.classList.remove('editing', 'completed', 'locked');
    });
    console.log(`üìç Current editing step: ${this.currentStep}`);
    // Wende States an
    for (let i = 1; i <= this.config.steps.length; i++) {
      const card = document.querySelector(`[data-step="${i}"]`);
      if (!card) continue;

      const headerActionEl = document.getElementById(`header-action-${i}`);

          // ‚úÖ F√úGE HIER HINZU: Spezialbehandlung f√ºr Step 9
    if (i === 9) {
      card.classList.add('editing'); // ‚úÖ Immer editing
      if (headerActionEl) {
        headerActionEl.innerHTML = '';
      }
      console.log(`‚úèÔ∏è  Step ${i}: EDITING (Consent Step - always editing)`);
      continue; // ‚úÖ Springe zum n√§chsten Step
    }

      if (i === this.currentStep) {
        // Dieser Step wird gerade bearbeitet
        card.classList.add('editing');

        // Leere den "√Ñndern" Button bei editing
        if (headerActionEl) {
         headerActionEl.innerHTML = '';
        }


        console.log(`‚úèÔ∏è  Step ${i}: EDITING`);
      } else if (this.completedSteps.includes(i)) {
        // Steps die bereits besucht wurden BLEIBEN COMPLETED
        card.classList.add('completed');
        this.updateCompletedDisplay(i);
        console.log(`‚úì Step ${i}: COMPLETED (besucht)`);
      } else {
        // Alle anderen Steps sind LOCKED (noch nicht besucht)
        card.classList.add('locked');
        console.log(`üîí Step ${i}: LOCKED`);
      }
    }
    this.attachChangeLinks();
  }

  // ===== NEUER CODE: Validierung vor Step 9 =====
validateAllStepsCompleted() {
  console.log('üîç Validating all steps before Step 9...');

  const requiredSteps = [1, 2, 3, 4, 5, 6, 7, 8]; // Alle Steps au√üer Step 9
  const missingSteps = requiredSteps.filter(step => !this.completedSteps.includes(step));

  if (missingSteps.length > 0) {
    console.log('‚ùå Missing steps:', missingSteps);

    // Finde den ERSTEN nicht-completed Step
    const firstMissingStep = missingSteps[0];

    // Setze diesen Step auf "editing"
    this.currentStep = firstMissingStep;
    this.dsStepsElement.current = firstMissingStep;
    this.saveCheckoutState();
    this.refreshAllStepStates();

    // Scroll zu diesem Step mit Highlight-Effekt
    setTimeout(() => {
      const targetCard = document.querySelector(`[data-step="${firstMissingStep}"]`);
      if (targetCard) {
        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Visueller Highlight-Effekt (optional)
        targetCard.style.transition = 'all 0.3s ease';
        targetCard.style.boxShadow = '0 0 20px rgba(255, 86, 0, 0.5)';
        setTimeout(() => {
          targetCard.style.boxShadow = 'none';
        }, 2000);
      }
    }, 300);

    // Zeige User-freundliche Nachricht
    this.showValidationError(firstMissingStep);
    return false;
  }

  console.log('‚úÖ All required steps completed!');
  return true;
}

showValidationError(step) {
  const stepConfig = this.config.steps.find(s => s.id === step);
  const message = `Bitte f√ºllen Sie zuerst Schritt ${step} aus: "${stepConfig.heading}"`;

  // Option 1: Browser-Alert (einfach)
  // alert(message);

  // Option 2: Toast-Nachricht (wenn verf√ºgbar)
  //this.showToast(message, 'warning');
  // Nutze Toast statt Alert
  if (window.toastManager) {
    window.toastManager.showToast(message, 'warning', 6000);
  } else {
    alert(message); // Fallback
  }

  console.log(message);
}

  handleNext(step) {
    console.log(`handleNext: step ${step}`);
    this.collectFormData(step);
    if (!this.validateStep(step)) {
      console.log('Validation failed');
      return;
    }
    // F√ºge aktuellen Step zu completedSteps hinzu
    if (!this.completedSteps.includes(step)) {
      this.completedSteps.push(step);
    }
    if (step < this.config.steps.length) {
      this.currentStep = step + 1;
      this.dsStepsElement.current = this.currentStep;
      this.saveCheckoutState();
      this.refreshAllStepStates();
      setTimeout(() => {
        document.querySelector(`[data-step="${step + 1}"]`).scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 300);
      this.stepStartTime = Date.now();
    } else {
      this.saveCheckoutState();
      this.completeCheckout();
    }
  }
  handlePrev(step) {
    console.log(`handlePrev: step ${step}`);
    if (step > 1) {
      this.currentStep = step - 1;
      this.dsStepsElement.current = this.currentStep;
      this.saveCheckoutState();
      this.refreshAllStepStates();
      setTimeout(() => {
        document.querySelector(`[data-step="${this.currentStep}"]`).scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 300);
      this.stepStartTime = Date.now();
    }
  }
  handleEdit(step) {
    console.log(`handleEdit: step ${step}`);
    this.currentStep = step;
    this.dsStepsElement.current = step;
    this.saveCheckoutState();
    this.refreshAllStepStates();
    setTimeout(() => {
      document.querySelector(`[data-step="${step}"]`).scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 300);
    this.stepStartTime = Date.now();
  }
  saveCheckoutState() {
    StorageManager.saveCheckoutState({
      currentStep: this.currentStep,
      completedSteps: this.completedSteps
    });
  }
  updateCompletedDisplay(step) {
    console.log(`updateCompletedDisplay: step ${step}`);
    const stepConfig = this.config.steps.find(s => s.id === step);
    const data = this.formData[step] || {};
    const headerActionEl = document.getElementById(`header-action-${step}`);
    const stepCard = document.querySelector(`[data-step="${step}"]`);

  // Nur zeige "√Ñndern" Button wenn Step NICHT editing ist
  if (headerActionEl && stepCard && !stepCard.classList.contains('editing')) {
    headerActionEl.innerHTML = `<button class="change-button-link icn-pencil-filled" data-step="${step}">√Ñndern</button>`;
  } else if (headerActionEl) {
    // Leere den Button wenn Step editing ist
    headerActionEl.innerHTML = '';
  }

    if (stepConfig.isConsentStep) {
      const newsletterValue = data['newsletter_consent'] ? 'Ja' : 'Nein';
      const completedNewsletterEl = document.getElementById('completed-newsletter_consent');
      if (completedNewsletterEl) {
        completedNewsletterEl.textContent = newsletterValue;
      }
      return;
    }
    stepConfig.completedDataFields.forEach(field => {
      if (field.valueIds) {
        const values = field.valueIds.map(id => data[id]);
        const transformedValue = field.transform ? field.transform(values) : values.join(' ');
        const el = document.getElementById(`completed-${field.valueIds[0]}`);
        if (el) el.textContent = transformedValue;
      } else {
        let value = data[field.valueId] || '';
        if (field.transform) {
          value = field.transform(value);
        }
        const el = document.getElementById(`completed-${field.valueId}`);
        if (el) el.textContent = value;
      }
    });
    const subtitleEl = document.getElementById(`subtitle-${step}`);
    if (subtitleEl && stepConfig.completedDataFields[0]) {
      const firstField = stepConfig.completedDataFields[0];
      let value = data[firstField.valueId] || '';
      if (firstField.transform) {
        value = firstField.transform(value);
      }
      subtitleEl.textContent = value;
    }
  }
  updateProgressBar() {
    console.log('=== updateProgressBar called ===');
    const dsStepsElement = document.getElementById('checkoutSteps');
    if (dsStepsElement) {
      dsStepsElement.current = this.currentStep;
      dsStepsElement.complete = this.completedSteps.length;
      console.log(`‚úì Progress updated to step ${this.currentStep}, complete ${this.completedSteps.length}`);
    }
  }
  completeCheckout() {
  console.log('Checkout completed');
  document.getElementById('checkoutSteps-container').style.display = 'none';


}


}
// ===== INITIALIZATION =====
console.log('Page loaded, initializing...');

let checkoutManager;
let toastManager; // üîë NEU

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    initTestModeModal();

    toastManager = new ToastManager(); // üîë HIER
    window.toastManager = toastManager; // üîë Global machen
    const stickyFooter = new StickyCheckoutFooter();
    const stepsManager = new StepsManager(CHECKOUT_CONFIG.steps);
    const stepsRenderer = new CheckoutStepsRenderer(CHECKOUT_CONFIG.steps);

    checkoutManager = new CheckoutManager(CHECKOUT_CONFIG);
    window.checkoutManager = checkoutManager;

    const drawerManager = new DrawerManager();
    const conditionalFieldManager = new ConditionalFieldManager(checkoutManager);
    const ibanFormatter = new IBANFormatter();
    const dateFormatter = new DateFormatter();
    checkoutManager.init();

    CHECKOUT_CONFIG.providers.forEach((config, index) => {
      new ProviderBoxManager(config, index);
    });

    console.log(`‚úì ${CHECKOUT_CONFIG.providers.length} Provider Box(es) loaded`);
  });
} else {
  initTestModeModal();

  toastManager = new ToastManager(); // üîë HIER
    window.toastManager = toastManager; // üîë Global machen
    const stickyFooter = new StickyCheckoutFooter();
    const stepsManager = new StepsManager(CHECKOUT_CONFIG.steps);
    const stepsRenderer = new CheckoutStepsRenderer(CHECKOUT_CONFIG.steps);

    checkoutManager = new CheckoutManager(CHECKOUT_CONFIG);
    window.checkoutManager = checkoutManager;

    const drawerManager = new DrawerManager();
    const conditionalFieldManager = new ConditionalFieldManager(checkoutManager);
    const ibanFormatter = new IBANFormatter();
    const dateFormatter = new DateFormatter();
    checkoutManager.init();

  CHECKOUT_CONFIG.providers.forEach((config, index) => {
    new ProviderBoxManager(config, index);
  });

  console.log(`‚úì ${CHECKOUT_CONFIG.providers.length} Provider Box(es) loaded`);
}
  </script>

  <!-- Load "prototype-sidecar.js". Used for common improvements for any prototype, e.g. protection and font loading -->
  <script src="prototype-sidecar.js"></script>
</body>
</html>
