<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Step Checkout - Mit Consent</title>
  <!-- Verivox Design System CSS -->
  <link rel="stylesheet" href="https://js.vxcdn.com/vx/ds-components/7/ds-components.css" />
  <!-- Verivox Design System Components -->
  <script type="module" src="https://js.vxcdn.com/vx/ds-components/7/ds-components.esm.js"></script>
  <!-- Verivox Icons -->
  <link rel="preload" href="https://js.vxcdn.com/vx/icons/7/VerivoxIcons.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://js.vxcdn.com/vx/icons/7/vx-icons.css" />
  <!-- Verivox DS Tokens (CSS Custom Properties) -->
  <link rel="stylesheet" href="https://js.vxcdn.com/vx/ds-tokens/4/tokens.css" />
  <link rel="stylesheet" href="https://js.vxcdn.com/vx/ds-tokens/latest/ds-typography.css" />

  <!-- Verivox Selawik Font  -->
  <link rel="preload" href="https://static.verivox.de/assets/fonts/de/selawik-100.woff" as="font" crossorigin="anonymous">
  <link rel="preload" href="https://static.verivox.de/assets/fonts/de/selawik-400.woff" as="font" crossorigin="anonymous">
  <link rel="preload" href="https://static.verivox.de/assets/fonts/de/selawik-700.woff" as="font" crossorigin="anonymous">
  <style>
      @font-face{font-family:Selawik;src:url(https://static.verivox.de/assets/fonts/de/selawik-400.woff) format("woff"),url(https://static.verivox.de/assets/fonts/de/selawik-400.woff2) format("woff2");font-weight:400;font-style:normal;font-display:optional}
      @font-face{font-family:Selawik;src:url(https://static.verivox.de/assets/fonts/de/selawik-100.woff) format("woff"),url(https://static.verivox.de/assets/fonts/de/selawik-100.woff2) format("woff2");font-weight:100;font-style:normal;font-display:optional}
      @font-face{font-family:Selawik;src:url(https://static.verivox.de/assets/fonts/de/selawik-700.woff) format("woff"),url(https://static.verivox.de/assets/fonts/de/selawik-700.woff2) format("woff2");font-weight:700;font-style:normal;font-display:optional}
      @font-face{font-family:VerivoxIcons;src:url(https://js.vxcdn.com/vx/icons/latest/VerivoxIcons.woff) format("woff"),url(https://js.vxcdn.com/vx/icons/latest/VerivoxIcons.woff2) format("woff2"),url(https://js.vxcdn.com/vx/icons/latest/VerivoxIcons.ttf) format("truetype");font-weight:400;font-style:normal}
      @font-face{font-family:verivox;src:url(https://js.vxcdn.com/vx/icons/latest/VerivoxIcons.woff) format("woff"),url(https://js.vxcdn.com/vx/icons/latest/VerivoxIcons.woff2) format("woff2"),url(https://js.vxcdn.com/vx/icons/latest/VerivoxIcons.ttf) format("truetype");font-weight:400;font-style:normal}
  </style>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Selawik, Segoe UI, Segoe, Open Sans, Calibri, Tahoma, Geneva, sans-serif;
      font-weight: var(--ds-font-weight-m, 400);
      background-color: var(--ds-background-neutral-light);
      padding-top: 0;
      min-height: 100vh;
    }
    /* ===== STICKY HEADER ===== */
    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background-color: white;
      border-bottom: 1px solid var(--ds-border-neutral-light);
    }
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: var(--ds-grid-size-fivefold);
      padding: 10px var(--ds-spacing-l);
      margin: 0 10px;
      border-bottom: 1px solid var(--ds-border-neutral-regular);
    }
    .header-logo {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-s);
      text-decoration: none;
      color: var(--ds-font-text-neutral-regular);
      height: 100%;
    }
    .header-logo img {
      height: 100%;
      width: auto;
      object-fit: contain;
    }
    .header-contact {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-l);
      text-align: right;
    }
    .header-phone {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      font-size: 13px;
      color: var(--ds-font-text-neutral-regular);
    }
    .header-phone .icn {
      font-size: 16px;
      color: var(--ds-font-text-brand-regular);
    }
    .header-hours {
      font-size: 11px;
      color: var(--ds-font-text-neutral-muted);
      line-height: 1.3;
    }
    .header-hours strong {
      display: block;
      font-weight: 600;
      color: var(--ds-font-text-neutral-regular);
    }
    /* ===== DS-STEPS PROGRESS WRAPPER ===== */
    .progress-wrapper {
      padding: 0  var(--ds-spacing-l) var(--ds-spacing-s) var(--ds-spacing-l);
      margin: 0 10px;
      background-color: white;
      border-bottom: 1px solid var(--ds-border-neutral-light);
    }
    ds-steps {
      --ds-steps-gap: var(--ds-spacing-m);
      display: flex !important;
      width: 100%;
      align-items: center;
    }
    .ds-steps {
    }
    /* ===== STORAGE INFO ===== */
    .storage-info {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      font-size: 11px;
      color: var(--ds-font-text-neutral-muted);
      padding: var(--ds-spacing-xxxs) var(--ds-spacing-l);
      background-color: var(--ds-background-neutral-light);
      border-top: 1px solid var(--ds-border-neutral-light);
    }
    .storage-info .icn {
      font-size: 12px;
    }
    .storage-info button {
      background: none;
      border: none;
      color: var(--ds-font-text-brand-regular);
      cursor: pointer;
      padding: 0;
      font-size: 11px;
      text-decoration: underline;
      font-family: inherit;
      transition: opacity 0.2s ease;
    }
    .storage-info button:hover {
      opacity: 0.8;
    }
    /* ===== MAIN CONTENT - GRID LAYOUT ===== */
    .main-content {
      padding: var(--ds-spacing-m);
      margin: 0 0 0 0;
    }
    .checkout-wrapper {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: var(--ds-spacing-xs);
      max-width: 980px;
      margin: 0 auto;
    }
    .checkout-intro {
      max-width: 980px;
      margin: 0 auto var(--ds-spacing-l) auto;
      color: var(--ds-font-text-neutral-regular);
      line-height: 2rem;
    }
    .checkout-container {
      flex: 1;
    }
    .provider-boxes-wrapper {
      display: flex;
      flex-direction: column;
    }
    .provider-box-item {
      position: sticky;
      top: 200px;
      height: fit-content;
    }
    /* ===== PROVIDER BOX ===== */
    .provider-box {
      background: var(--ds-background-white);
      border: var(--ds-stroke-m) solid var(--ds-border-neutral-muted);
      border-radius: var(--ds-radius-xl);
      padding: var(--ds-spacing-xs);
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-s);
    }
    .provider-header {
      /*display: flex;*/
      align-items: center;
      gap: var(--ds-spacing-m);
      padding-bottom: var(--ds-spacing-s);
    }
    .provider-offer {
        display: flex;

    }
    .provider-logo {
      width: 60px;
      height: 60px;
      border-radius: var(--ds-radius-l);
      background-color: var(--ds-background-neutral-light);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      overflow: hidden;
    }
    .provider-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .provider-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-xxxs);
    }
    .provider-name {
      font-size: var(--ds-font-size-l);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
    }
    .provider-rating {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      font-size: 12px;
      color: var(--ds-font-text-neutral-muted);
    }
    .provider-rating .stars {
      display: flex;
      gap: 2px;
    }
    .provider-rating .star {
      color: var(--ds-icon-brand-regular);
      font-size: 14px;
    }
    /* ===== PRICE SECTION ===== */
    .price-section {
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-xxs);
    }
    .price-value {
      font-size: var(--ds-font-size-xl);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
      display: flex;
      align-items: baseline;
      gap: var(--ds-spacing-xs);
    }
    .price-amount {
      display: flex;
      align-items: baseline;
      gap: var(--ds-spacing-xxs);
    }
    .price-currency {
      font-size: var(--ds-font-size-xl);
      color: var(--ds-font-headline-neutral-regular);
      font-weight: var(--ds-font-weight-l);
    }
    .price-period {
      font-size: 12px;
      color: var(--ds-font-text-neutral-muted);
      font-weight: var(--ds-font-weight-m);
    }
    .price-help {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-m);
      color: var(--ds-font-text-neutral-regular);
      cursor: help;
    }
    .price-help .icn {
      font-size: 14px;
    }
    /* ===== DETAILS SECTION ===== */
    .details-section {
      display: flex;
      flex-direction: column;
    }
    .detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--ds-spacing-xs);
      padding: var(--ds-spacing-xxs) 0;
      background-color: var(--ds-background-white);
    }
    .detail-label {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-m);
    }
    .detail-value {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-l);
      text-align: right;
    }
    /* ===== ACTION LINK ===== */
    .action-link {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: var(--ds-spacing-xxxs);
      font-size: 19px;
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-text-brand-regular);
      text-decoration: none;
      cursor: pointer;
      padding: var(--ds-spacing-xs) 0;
      transition: opacity 0.2s ease;
      border: none;
      background: none;
      font-family: inherit;
    }
    .action-link:hover {
      opacity: 0.8;
    }
    .action-link .icn {
      font-size: 14px;
    }
    /* ===== DRAWER OVERLAY ===== */
    .drawer-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--ds-overlay-neutral-dark, rgba(0, 0, 0, 0.5));
      z-index: 999;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .drawer-overlay.open {
      display: block;
      opacity: 1;
    }
    /* ===== DRAWER ===== */
    .drawer {
      position: fixed;
      top: 0;
      right: 0;
      width: 90vw;
      max-width: 600px;
      height: 100vh;
      background-color: white;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
    }
    .drawer.open {
      transform: translateX(0);
    }
    .drawer-header {
      display: block;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--ds-spacing-xs);

      background-color: var(--ds-background-neutral-muted);
    }
    .drawer-title {
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
      margin: 0;
      /*flex: 1;*/
      padding: var(--ds-spacing-xs) var(--ds-spacing-xs) 0 var(--ds-spacing-xs);
    }
    .drawer-back-button {

      align-items: center;
      justify-content: center;
      gap: var(--ds-spacing-xxxs);
      padding: var(--ds-spacing-xxs) 0;
      background: none;
      border: none;
      cursor: pointer;
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-m);
      color: var(--ds-font-text-neutral-regular);
      font-family: inherit;
      transition: opacity 0.2s ease;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .drawer-back-button:hover {
      opacity: 0.8;
    }
    .drawer-back-button .icn {
      font-size: 16px;
      order: 2;
      color: var(--ds-icon-brand-regular);
    }
    .drawer-content {
      flex: 1;
      overflow-y: auto;
      padding: var(--ds-spacing-xs);
    }
    .drawer-section-content {
      display: flex;
      flex-direction: column;
      /*gap: var(--ds-spacing-s);*/
      padding: var(--ds-spacing-xxs) 0;
    }
    .drawer-subsection-item {
      display: flex;
      flex-direction: column;
      /*gap: var(--ds-spacing-s);*/
      padding: var(--ds-spacing-xxs);
      gap: var(--ds-spacing-xxs);
      /*background-color: var(--ds-background-neutral-light);*/
      border-radius: var(--ds-stroke-l);
      margin-bottom: var(--ds-spacing-xxs);
    }

    .drawer-subsection-item-label {
        font-size: var(--ds-font-size-m);
        color: var(--ds-font-text-neutral-regular);
        font-weight: var(--ds-font-weight-l);
        word-break: break-word;
        padding-bottom: var(--ds-spacing-xxs);
        border-bottom: var(--ds-stroke-m) solid var(--ds-border-neutral-regular);
    }

    .drawer-list-item {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--ds-spacing-m);
      padding: var(--ds-spacing-xxs) 0;
      border-radius: var(--ds-radius-l);

      border-left: 4px solid transparent;
      transition: all 0.2s ease;
    }
    .drawer-list-item:hover {
      /*background-color: var(--ds-background-neutral-muted);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);*/
    }
    .drawer-list-item.highlight {
        background-color: var(--ds-background-brand-light);
        border: var(--ds-stroke-m) solid var(--ds-border-brand-muted);
        padding: var(--ds-spacing-xxxs);
    }
    .drawer-list-item.highlight .drawer-item-label {

      font-weight: var(--ds-font-weight-m);
    }
    .drawer-list-item.highlight .drawer-item-value {

      font-weight: var(--ds-font-weight-l);
    }
    .drawer-item-label {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-m);
      word-break: break-word;
    }
    .drawer-item-value {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-l);
      text-align: left;
      word-break: break-word;
      line-height: 1.4;
    }
    /* ===== STEP CARD STATES ===== */
    .step-card {
      background: var(--ds-background-white);
      border: var(--ds-stroke-m) solid var(--ds-border-neutral-muted);
      border-radius: var(--ds-radius-xl);
      overflow: visible;
      transition: all 0.3s ease-in-out;
      position: relative;
      margin-bottom: var(--ds-spacing-xs);
    }
    .step-card.editing {
      border-color: var(--ds-border-neutral-muted);
      box-shadow: none;
    }
    .step-card.locked {
      opacity: 0.7;
    }
    .step-card.completed {
      border: var(--ds-stroke-l) solid var(--ds-border-success-regular);
    }
    .step-card.completed ds-ribbon {
      position: absolute;
      top: -16px;
      left: -2px;
      z-index: 10;
      display: block;
    }
    .step-card:not(.completed) ds-ribbon {
      display: none;
    }
    /* ===== CARD HEADER ===== */
    .step-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--ds-spacing-s) var(--ds-spacing-xs);
      cursor: pointer;
      user-select: none;
      border-bottom: 1px solid var(--ds-border-neutral-light);
      transition: background-color 0.2s ease;
      background-color: transparent;
    }
    .step-header:hover:not(.locked-header) {
      background-color: var(--ds-background-neutral-light);
    }
    .step-card.completed .step-header {
      border-bottom: none;
      cursor: default;
      background-color: transparent;
    }
    .step-card.completed .step-header:hover {
      background-color: transparent;
    }
    .step-card.editing .step-header {
      border-bottom: 1px solid var(--ds-border-neutral-light);
    }
    .step-card.locked .step-header {
      cursor: default;
    }
    .step-card.locked .step-header:hover {
      background-color: white;
    }
    .step-header-left {
      display: flex;
      align-items: center;
      flex: 1;
    }
    .step-header-right {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xs);
      margin-left: var(--ds-spacing-xs);
    }
    .step-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--ds-grid-size-quadruple);
      height: var(--ds-grid-size-quadruple);
      margin-right: var(--ds-spacing-xxs);
      font-size: 24px;
      flex-shrink: 0;
      color: var(--ds-font-text-neutral-regular);
    }
    .step-icon.icn {
      font-size: 24px;
    }
    .step-card.editing .step-icon {
      color: var(--ds-icon-neutral-regular);
    }
    .step-card.completed .step-icon {
      color: var(--ds-icon-success-regular);
    }
    .step-card.locked .step-icon {
      color: var(--ds-font-text-neutral-muted);
    }
    .step-title {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .step-title h2 {
      font-size: var(--ds-font-size-l);
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-headline-neutral-regular);
      margin: 0;
    }
    .step-card.locked .step-title h2 {
      color: var(--ds-font-text-neutral-muted);
    }
    .step-card.completed .step-title h2 {
      color: var(--ds-font-text-neutral-regular);
    }
    .step-subtitle {
      font-size: 12px;
      color: var(--ds-font-text-neutral-muted);
      display: none;
    }
    .step-card.completed .step-subtitle {
      display: none;
    }
    .change-button-link {
      display: flex;
      align-items: center;
      gap: var(--ds-spacing-xxxs);
      font-size: 19px;
      font-weight: var(--ds-font-weight-l);
      color: var(--ds-font-text-brand-regular);
      text-decoration: none;
      cursor: pointer;
      white-space: nowrap;
      transition: opacity 0.2s ease;
      border: none;
      background: none;
      font-family: inherit;
    }
    .change-button-link:hover {
      opacity: 0.8;
    }
    /* ===== CARD CONTENT ===== */
    .step-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
      padding: 0;
    }
    .step-card.editing .step-content {
      max-height: 1200px;
      padding: var(--ds-spacing-xs);
    }
    .step-form {
      display: flex;
      flex-direction: column;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-xxxs);
    }
    .form-group label {
      font-size: var(--ds-font-size-m);
      font-weight: var(--ds-font-weight-m);
      color: var(--ds-font-text-neutral-regular);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .form-group label .label-text {
      flex: 1;
    }
    .form-group label .info-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      margin-left: var(--ds-spacing-xs);
      flex-shrink: 0;
      cursor: help;
      color: var(--ds-font-text-neutral-muted);
    }
    .form-actions {
      display: flex;
      gap: var(--ds-spacing-xs);
      margin-top: var(--ds-spacing-xs);
    }
    .form-actions.full-width {
      flex-direction: column;
    }
    .form-actions.full-width > div {
      display: flex;
      gap: var(--ds-spacing-xs);
    }
    ds-button[appearance="primary"] {
      --ds-button-width: 100%;
    }
    .form-actions ds-button {
      min-height: 48px;
    }
    /* ===== CONSENT CHECKBOX STYLING ===== */
    .consent-section {
      display: flex;
      flex-direction: column;
      gap: var(--ds-spacing-s);
    }
    .consent-checkbox-wrapper {
      display: flex;
      align-items: flex-start;
    }
    ds-checkbox {
      flex-shrink: 0;
      margin-top: 2px;
    }
    .consent-text {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      line-height: 1.5;
    }
    .consent-text a {
      color: var(--ds-font-text-neutral-regular);
      text-decoration: underline;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }
    .consent-text a:hover {
      opacity: 0.8;
    }
    .disclaimer-text {
        padding: var(--ds-spacing-xs) 0;
        font-size: var(--ds-font-size-s);
        color: var(--ds-font-text-neutral-regular);
    }
    .disclaimer-text a {
        color: var(--ds-font-text-neutral-regular);
        text-decoration: underline;
        cursor: pointer;
        transition: opacity 0.2s ease;
    }
    .disclaimer-text a:hover {
      opacity: 0.8;
    }


    /* ===== COMPLETED CONTENT ===== */
    .step-completed-content {
      display: none;
      padding: var(--ds-spacing-xs);
      background-color: white;
    }
    .step-card.completed .step-completed-content {
      display: block;
    }
    .completed-data {
      display: grid;
      gap: var(--ds-spacing-xs);
    }
    .completed-data-row {
      display: flex;
      flex-direction: column;
    }
    .data-item {
      display: grid;
      grid-template-columns: 1fr 1fr;
      justify-content: space-between;
      align-items: center;
      gap: var(--ds-spacing-xs);
      padding: var(--ds-spacing-xxs) 0;
      background-color: var(--ds-background-white);
    }
    .data-label {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-m);
      text-align: left;
      word-break: break-word;
    }
    .data-value {
      font-size: var(--ds-font-size-m);
      color: var(--ds-font-text-neutral-regular);
      font-weight: var(--ds-font-weight-l);
      text-align: left;
      word-break: break-word;
    }
    /* ===== SUCCESS MESSAGE ===== */
    .success-message {
      display: none;
      padding: var(--ds-spacing-m);
      margin-bottom: var(--ds-spacing-xl);
      background-color: var(--ds-background-success-light);
      border: 1px solid var(--ds-border-success-regular);
      border-radius: var(--ds-radius-xl);
      color: var(--ds-font-text-success-regular);
      text-align: center;
      font-weight: 500;
    }
    .success-message.show {
      display: block;
      animation: slideDown 0.3s ease;
    }
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    ds-input {
      width: 100%;
    }
    ds-select {
      width: 100%;
    }
    html {
      scroll-behavior: smooth;
    }
    .scroll-target {
      scroll-margin-top: 200px;
    }
    /* ===== RESPONSIVE TABLET ===== */
    @media (max-width: 1024px) {
      .checkout-wrapper {
        grid-template-columns: 1fr;
      }
      .provider-box-item {
        position: static;
      }
    }
    /* ===== RESPONSIVE MOBILE ===== */
    @media (max-width: 768px) {
      .header-top {
        padding: 10px var(--ds-spacing-m);
      }
      .main-content {
        padding: var(--ds-spacing-s);
      }
      .checkout-wrapper {
        grid-template-columns: 1fr;
      }
      .drawer {
        max-width: 100%;
        width: 100%;
      }
      .completed-data-row {
        grid-template-columns: 1fr;
      }
      .drawer-list-item {
        grid-template-columns: 1fr;
        gap: var(--ds-spacing-xs);
      }
      .drawer-item-value {
        text-align: left;
      }
    }
    @media (max-width: 480px) {
      .header-top {
        padding: 10px var(--ds-spacing-s);
      }
      .header-contact {
        gap: var(--ds-spacing-s);
      }
      .main-content {
        padding: var(--ds-spacing-s);
      }
    }
  </style>
</head>
<body>
  <!-- STICKY HEADER -->
  <div class="sticky-header">
    <!-- Header Top -->
    <div class="header-top">
      <a href="#" class="header-logo">
        <img src="img/verivox-logo.png" alt="Verivox" />
      </a>
      <div class="header-contact">
        <div class="header-phone">
          <span class="icn icn-phone-filled" aria-hidden="true"></span>
          <span>0621 777 00 10</span>
        </div>
        <div class="header-hours">
          <strong>Mo-Fr 8-22 Uhr</strong>
          Sa, So 9-22 Uhr
        </div>
      </div>
    </div>
    <!-- DS-STEPS Progress Bar -->
    <div class="progress-wrapper">
      <ds-steps
        id="checkoutSteps"
        interactive
        current="1"
        complete="1"
        circle-mode="counter"
      >
        <!-- Steps werden dynamisch eingefügt -->
      </ds-steps>
    </div>
    <!-- Storage Info -->
    <div class="storage-info">
      <span class="icn icn-database-filled" aria-hidden="true"></span>
      <span id="storage-status">Daten gespeichert</span>
      <button id="clear-storage" type="button" aria-label="Gespeicherte Daten löschen">Löschen</button>
    </div>
  </div>
  <!-- MAIN CONTENT -->
  <div class="main-content">
    <div class="checkout-intro"><h1>Nur wenige Schritte bis zum Abschluss</h1><p>Bitte prüfen und vervollständigen Sie Ihre Angaben</p></div>
    <!-- CHECKOUT WRAPPER - GRID LAYOUT -->
    <div class="checkout-wrapper">
      <!-- CHECKOUT CONTAINER (LEFT SIDE) -->
      <div class="checkout-container">
        <div class="success-message" id="successMessage">
          ✓ Checkout erfolgreich abgeschlossen!
        </div>
        <div class="checkout-steps" id="checkoutSteps-container">
          <!-- Wird dynamisch gefüllt -->
        </div>
      </div>
      <!-- PROVIDER BOXES (RIGHT SIDE) - DYNAMISCH GENERIERT -->
      <div class="provider-boxes-wrapper" id="providerBoxesWrapper">
        <!-- Wird dynamisch gefüllt -->
      </div>
    </div>
  </div>
  <!-- DRAWER OVERLAY -->
  <div class="drawer-overlay" id="drawerOverlay"></div>
  <!-- DRAWER - WIRD DYNAMISCH GEFÜLLT -->
  <div class="drawer" id="tariffDrawer">
    <div class="drawer-header">
        <button class="drawer-back-button" id="closeDrawer" type="button" aria-label="Drawer schließen">
            <span class="icn icn-angle-left-filled" aria-hidden="true"></span>
            <span>Zurück</span>
          </button>
    </div>
    <div class="provider-offer">
        <div class="provider-header">
            <div class="provider-logo">
                <img src="${this.config.logo}" alt="${this.config.name}" />
            </div>
            <div class="provider-info">
                <div class="provider-name">${this.config.name}</div>
                <div class="provider-rating">
                    <div class="stars">
                        ${createStarsHTML(this.config.rating)}
                    </div>
                    <span>${this.config.rating}</span>
                </div>
            </div>
        </div>
        <div class="price-section">
            <div class="price-value">
                <div class="price-amount">
                    <span>${this.config.price.toFixed(2)}</span>
                    <span class="price-currency">€</span>
                </div>
            </div>
        <div class="price-help">
            <span>${this.config.pricePeriod}</span>
            <span class="icn icn-info-circle-filled" aria-hidden="true"></span>
        </div>
    </div>
  </div>
    <h2 class="drawer-title" id="drawerTitle">Tarif- und Preisdetails</h2>

    <div class="drawer-content" id="drawerContent">

      <!-- Wird dynamisch gefüllt -->
    </div>
  </div>
  <script>
    // ===== CHECKOUT CONFIGURATION (JSON) =====
    const CHECKOUT_CONFIG = {
      steps: [
        {
          id: 1,
          heading: 'Versicherungsnehmer',
          icon: 'icn-man-document-outlined',
          fields: [
            {
              id: 'salutation',
              type: 'select',
              label: 'Anrede',
              required: true,
              placeholder: 'Bitte Anrede wählen',
              options: [
                { value: '', label: 'Bitte Anrede wählen' },
                { value: 'Herr', label: 'Herr' },
                { value: 'Frau', label: 'Frau' },
                { value: '', label: 'Divers' }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte wählen Sie eine Anrede'
              }
            },
            {
              id: 'firstName',
              type: 'input',
              inputType: 'text',
              label: 'Vorname',
              required: true,
              placeholder: 'Max',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Vorname muss mindestens 2 Zeichen lang sein'
              }
            },
            {
              id: 'lastName',
              type: 'input',
              inputType: 'text',
              label: 'Nachname',
              required: true,
              placeholder: 'Mustermann',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Nachname muss mindestens 2 Zeichen lang sein'
              }
            },
            {
              id: 'email',
              type: 'input',
              inputType: 'email',
              label: 'E-Mail-Adresse',
              required: true,
              placeholder: 'max@example.de',
              validation: {
                validate: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
                error: 'Bitte geben Sie eine gültige E-Mail-Adresse ein'
              }
            }
          ],
          completedDataFields: [
            { label: 'Name', valueIds: ['salutation', 'firstName', 'lastName'], transform: (vals) => `${vals[0]} ${vals[1]} ${vals[2]}` },
            { label: 'Email', valueId: 'email' }
          ]
        },
        {
          id: 2,
          heading: 'Beruf',
          icon: 'icn-wrench-outlined',
          fields: [
            {
                id: 'profession',
                type: 'select',
                label: 'Ihre derzeitige Berufsbezeichnung',
                required: true,
                placeholder: 'Bitte wählen...',
                options: [
                { value: '', label: 'Bitte ergänzen Sie die genaue aktuelle Berufbezeichnung' },
                { value: 'Abrisshelfer', label: 'Abrisshelfer' },
                { value: 'Bankkaufleute', label: 'Bankkaufleute' },
                { value: 'Journalisten', label: 'Journalisten' }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte ergänzen Sie die genaue aktuelle Berufbezeichnung'
              }
            }
          ],
          completedDataFields: [
            { label: 'Berufsbezeichnung', valueId: 'profession' }
          ]
        },
        {
          id: 3,
          heading: 'Kontaktadresse',
          icon: 'icn-location-outlined',
          fields: [
            {
                id: 'zip',
                type: 'input',
                inputType: 'text',
                label: 'Postleitzahl',
                required: true,
                placeholder: '06911',
                validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Postleitzahl ein'
              }
            },
            {
                id: 'city',
                type: 'input',
                inputType: 'text',
                label: 'Ort',
                required: true,
                placeholder: '',
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte ergänzen Sie den Ort an'
              }
            },
            {
                id: 'street',
                type: 'input',
                inputType: 'text',
                label: 'Straße',
                required: true,
                placeholder: '',
                validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Straße an'
              }
            },
            {
                id: 'housenumber',
                type: 'input',
                inputType: 'text',
                label: 'Hausnummer',
                required: true,
                placeholder: '',
                validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Hausnummer an'
              }
            },
            {
                id: 'phone',
                type: 'input',
                inputType: 'text',
                label: 'Telefonnummer',
                required: true,
                placeholder: '',
                validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Telefonnummer an'
              }
            }
          ],
          completedDataFields: [
            { label: 'Anschrift', valueIds: ['street', 'housenumber', 'zip', 'city'], transform: (vals) => `${vals[0]} ${vals[1]}, ${vals[2]} ${vals[3]}` },
            { label: 'Telefonnummer', valueId: 'phone' }
          ]
        },
        {
          id: 4,
          heading: 'Fahrzeuge',
          icon: 'icn-car-outlined',
          fields: [
            {
                id: 'familyCars',
                type: 'select',
                label: 'Anzahl der Fahrzeuge in der Familie',
                required: false,
                placeholder: 'Bitte wählen...',
                options: [
                { value: 'keine', label: '0' },
                { value: '1', label: '1' },
                { value: '2', label: '2' },
                { value: '3', label: '3' },
                { value: '4', label: '4' },
                { value: '5', label: '5' },
                { value: '6', label: '6' }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte geben Sie die Anzahl der Fahrzeuge in Ihrer Familie an'
              }
            }
          ],
          completedDataFields: [
            { label: 'Fahrzeuge in der Familie', valueId: 'familyCars' }
          ]
        },
        {
          id: 5,
          heading: 'Wohnen',
          icon: 'icn-house-outlined',
          fields: [
          {
                id: 'unitLpi',
                type: 'select',
                label: 'RS für selbstbewohnte Wohneinheit als',
                required: false,
                placeholder: 'Bitte wählen...',
                options: [
                { value: 'Mieter einer Wohnung', label: 'Mieter einer Wohnung' },
                { value: 'Eigentümer eines Hauses', label: 'Eigentümer eines Hauses' },
                { value: 'Eigentümer einer Wohnung', label: 'Eigentümer einer Wohnung' },
                { value: 'Mieter eines Hauses', label: 'Mieter eines Hauses' },
                { value: 'Mehrere WE auf Anfrage', label: 'Mehrere WE auf Anfrage' }
              ],
              validation: {
                validate: (value) => value.length > 0,
                error: 'Bitte geben Sie ob Rechtschutz für die selbstbewohnte WE bestehen soll'
              }
            },
          {
              id: 'zipUnit',
              type: 'input',
              inputType: 'text',
              label: 'PLZ der Immobilie',
              required: true,
              placeholder: 'PLZ',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die PLZ ein'
              }
            },
            {
              id: 'cityUnit',
              type: 'input',
              inputType: 'text',
              label: 'Ort der Immobilie',
              required: true,
              placeholder: 'Ort',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie den Ort ein'
              }
            },
            {
              id: 'streetUnit',
              type: 'input',
              inputType: 'text',
              label: 'Straße',
              required: true,
              placeholder: 'Straße',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie die Straße ein'
              }
            },
            {
              id: 'housenumberUnit',
              type: 'input',
              inputType: 'text',
              label: 'Hausnummer',
              required: true,
              placeholder: 'Hausnummer',
              validation: {
                validate: (value) => value.length >= 1,
                error: 'Bitte geben Sie die Hausnummer ein'
              }
            }
          ],
          completedDataFields: [
            { label: 'Rechtschutz für selbstbewohnte Wohneinheit als', valueId: 'unitLpi' },
            { label: 'Anschrift der Wohneinheit', valueIds: ['streetUnit', 'housenumberUnit', 'zipUnit', 'cityUnit'], transform: (vals) => `${vals[0]} ${vals[1]}, ${vals[2]} ${vals[3]}` }
          ]
        },
        {
          id: 6,
          heading: 'Versicherungsbeginn',
          icon: 'icn-calendar-outlined',
          fields: [
          {
              id: 'startIns',
              type: 'input',
              inputType: 'text',
              label: 'Gewünschter Versicherungsbeginn',
              required: true,
              placeholder: 'TT.MM.JJJJ',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte Versicherungsbeginn angeben'
              }
            }
          ],
          completedDataFields: [
            { label: 'Gewünschter Versicherungseginn', valueId: 'startIns' }
          ]
        },
        {
          id: 7,
          heading: 'Bankdaten',
          icon: 'icn-bank-outlined',
          fields: [
          {
              id: 'iban',
              type: 'input',
              inputType: 'text',
              label: 'IBAN',
              required: true,
              placeholder: 'DE40',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie eine IBAN an'
              }
            },
            {
              id: 'bank',
              type: 'input',
              inputType: 'text',
              label: 'Name der Bank',
              required: true,
              placeholder: 'Kreditinstitut',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie den Namen der Bank an'
              }
            }
          ],
          completedDataFields: [
            { label: 'IBAN', valueId: 'iban' },
            { label: 'Kreditinstitut', valueId: 'bank' }
          ]
        },
        {
          id: 8,
          heading: 'Zusatzfragen',
          icon: 'icn-checklist-outlined',
          fields: [
          {
              id: 'additionalTrue',
              type: 'select',
              label: 'Sind Umstände bekannt, die auf ein anstehendes oder bereits eingeleitetes strafrechtliches Ermittlungsverfahren hinweisen?',
              required: false,
              placeholder: 'Kurze Erläuterung...',
              options: [
                { value: 'nein', label: 'nein' },
                { value: 'ja', label: 'ja' }
              ],
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie Straße und Hausnummer ein'
              }
            },
        {
            id: 'additionalExplication',
              type: 'input',
              inputType: 'text',
              label: 'Bitte erläutern Sie kurz um was es sich handelt.',
              required: true,
              placeholder: 'Musterstr. 1',
              validation: {
                validate: (value) => value.length >= 2,
                error: 'Bitte geben Sie Straße und Hausnummer ein'
              }
        }
          ],
          completedDataFields: [
            { label: 'Bekannte Umstände, die auf ein anstehendes oder bereits eingeleitetes strafrechtliches Ermittlungsverfahren hinweisen', valueId: 'additionalTrue' },
            { label: 'Erläuterung', valueId: 'additionalExplication' }
          ]
        },
        {
          id: 9,
          heading: 'Antragsabschluss',
          icon: 'icn-thumbs-up-outlined',
          isConsentStep: true,
          completedDataFields: [
            { label: 'Newsletter', valueId: 'newsletter_consent', transform: (val) => val ? 'Ja' : 'Nein' }
          ]
        }
      ],
      providers: [
        {
          id: 'box-1',
          logo: 'img/provider-logo.png',
          name: 'ARAG Komfort (Var. SB) (Koop / SV)',
          rating: 4.5,
          ratingCount: 128,
          price: 1386.07,
          pricePeriod: 'pro Jahr',
          details: [
            { label: 'Deckungssumme', value: 'unbegrenzt' },
            { label: 'Selbstbeteiligung', value: '300 / 150 EUR' },
            { label: 'Folgeereignistheorie (Ursache vor Versicherungsbeginn)', value: 'ja' },
            { label: 'Spezial-Straf-Rechtsschutz', value: 'ja' },
            { label: 'Rechtsschutz für Unterhalt', value: 'nein' },
            { label: 'Rechtsschutz in Ehesachen (nur wenn verheiratet)', value: 'nein' }
          ],
          actionLink: {
            text: 'Vertragskonditionen',
            icon: 'icn-looking-glass-filled'
          },
          drawerConfig: {
            title: 'Vertragskonditionen',
            sections: [
              {
                title: 'Allgemein',
                subsections: [
                    {
                        title: 'Deckungsumfang & -summen',
                        items: [
                            { label: 'Deckungsumfang', value: 'Privat Beruf Verkehr (VN) Wohnen Vermietung' },
                            { label: 'Selbstbeteiligung', value: '500 EUR', highlight: true  },
                            { label: 'Deckungssumme', value: 'unbegrenzt' },
                            { label: 'Kautionsdarlehen', value: 'bis zu 1 Mio EUR' },
                            { label: 'Kündigungsfristen', value: 'zum Vertragsablauf, Kündigungsfrist 3 Monate' }
                        ]
                    },
                    {
                        title: 'Versicherte Personen',
                        items: [
                        { label: 'Versicherungsnehmer', value: 'versichert Sofern Vertragsumfang versichert/vereinbart: Einschluss Wohnen/Vermietung: • auch in der Eigenschaft als Eigentümer, Vermieter, Verpächter, Mieter, Pächter, Nutzungsberechtigter' },
                        { label: 'Partner', value: 'versichert Sofern Vertragsumfang versichert/vereinbart: Einschluss Privat/Beruf/Verkehr: Ehe-/Lebenspartner Achtung: • die Mitversicherung des Lebenspartners muss beantragt werden • Einschluss Beruf bei Senior-Tarifen nicht möglich' },
                        { label: 'Eltern', value: 'versichert Sofern Vertragsumfang versichert/vereinbart: Einschluss Privat/Beruf/Verkehr: • Eltern und Großeltern, sofern sich diese im Ruhestand befinden und mit dem VN in h.G. leben. Achtung: die Mitversicherung der Eltern und Großeltern muss beantragt werden.' },
                        { label: 'Großeltern, sonstige Personen', value: 'versichert Sofern Vertragsumfang versichert/vereinbart: Einschluss Privat/Beruf/Verkehr: • Eltern und Großeltern, sofern sich diese im Ruhestand befinden und mit dem VN in h.G. leben. Achtung: die Mitversicherung der Eltern und Großeltern muss beantragt werden.' }

                        ]
                    },
                    {
                        title: 'Versicherte Tätigkeiten',
                        items: [
                        { label: 'Selbstständige Tätigkeit der versicherten Person bis zu einem bestimmten Jahresumsatz erlaubt', value: 'nicht versichert' },
                        { label: 'Mitversicherung nebenberuflicher, ehrenamtlicher Tätigkeiten', value: 'versichert' },
                        { label: 'Vorsorge bei Aufnahme einer freiberuflichen Tätigkeit', value: 'ohne Wartezeit, versichert' },
                        { label: 'Auslandsaufenthalt zeitlich begrenzt', value: 'im örtlichen Geltungsbereich mitversichert; Über Spezial-Straf-Rechtsschutz weltweiter Versicherungsschutz' },
                        { label: 'Auslandsdeckung im Beruf', value: 'versichert, im Geltungsbereich ohne zeitliche Begrenzung; weltweit: Urlaubs-, Dienst- oder Geschäftsreise, Work&Travel, Au-pair Aufenthalt; Schüleraustausch oder Auslandsemester bis zu 12 Monate; private Verträge über das Internet' }

                        ]
                    },
                    {
                        title: 'Anwaltswahl & telefonische Auskünfte',
                        items: [
                        { label: 'Ent­schei­dung über die De­ckun­gs­zu­sa­ge', value: 'Stichentscheid' },
                        { label: 'Freie Rechts­an­walts­wahl', value: 'ja' },
                        { label: 'Scha­dens­fäl­le vor Ver­si­che­run­gs­be­ginn', value: 'versichert, sofern betroffenes Risiko seit mind. 5 Jahren ununterbrochen bei der Auxilia mitversichert' },
                        { label: 'Telefonische Erstberatung', value: 'versichert • in allen Rechtsschutzangelegenheiten • auch Online-Beratung' },
                        { label: 'Te­le­fo­ni­sche An­walts­aus­künf­te für nicht ver­si­cher­te Ri­si­ken', value: 'versichert • in allen Rechtsschutzangelegenheiten • auch Online-Beratung' },
                        { label: 'Te­le­fo­ni­sche An­walts­aus­künfte für nicht ver­si­cher­ba­re Ri­si­ken', value: 'nicht versichert' },
                        { label: 'Me­dia­ti­ons­ver­fah­ren (An­zahl und Höhe der Sit­zun­gen)', value: 'bis zu 3.000 EUR Jahreshöchstentschädigung max. 6.000 EUR auch für ausgeschlossene Rechtsangelegenheiten (Mediation XXL)' }

                        ]
                    },
                    {
                        title: 'Leistungsaussagen',
                        items: [
                        { label: 'Leistungsaussagen', value: '' },
                        { label: 'Strafvollstreckungsmaßnahmen', value: 'versichert, ab einer Geldstrafe oder -buße ab 255 EUR' },
                        { label: 'Eherechtschutz', value: 'nicht versichert' },
                        { label: 'Unterhaltsrechtsschutz', value: 'Kosten der anwaltlichen Erstberatung' },
                        { label: 'Innovationsklausel (Bedingungsverbesserungen)', value: 'versichert' },
                        { label: 'Besonderheiten bei Arbeitslosigkeit', value: 'nicht versichert' },
                        { label: 'Kapitalanlagen', value: 'risikoarme Kapitalanlagen: Summe unbegrenzt' },
                        { label: 'Photovoltaikanlagen', value: 'bis zu 20.000 EUR' }

                        ]
                    }
                ]
              },
              {
                title: 'Privat- und Vertragsrechtsschutz',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Ord­nun­gs­wid­rig­kei­ten-Rechts­schutz', value: 'gerichtlich und außergerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Scha­denser­satz-Rechts­schutz', value: 'nicht versichert' },
                        { label: 'Rechts­schutz im Ver­trags- und Sach­recht', value: 'gerichtlich und außergerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Straf-Rechts­schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Steu­er-Rechts­schutz vor Ge­rich­ten', value: 'nicht versichert' },
                        { label: 'Ver­wal­tun­gs­rechts­schutz für Wi­der­spruchs­ver­fah­ren', value: 'nicht versichert' },
                        { label: 'Ver­wal­tun­gs­rechts­schutz (ge­richt­lich)', value: 'ab vorgeschaltetem Widerspruchsverfahren, ohne Wartezeit, Summe unbegrenzt gerichtlich mitversichert' },
                        { label: 'So­zi­al­ge­richts­rechts­schutz für Wi­der­spruchs­ver­fah­ren', value: 'nicht versichert' },
                        { label: 'So­zi­al­ge­richts­rechts­schutz (ge­richt­lich)', value: 'ab vorgeschaltetem Widerspruchsverfahren, ohne Wartezeit, Summe unbegrenzt gerichtlich mitversichert' },
                        { label: 'Dis­zi­pli­nar- und Stan­des-Rechts­schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Beratung im Familien- und Erbrecht', value: 'ohne Wartezeit, versichert • Über die Beratung hinausgehende Tätigkeit 1.000 EUR. • Auch gerichtliche Auseinandersetzungen in erbrechtlichen Streitigkeiten bis 10.000 EUR pro Vertragslaufzeit. Wartezeit 12 Monate' },
                        { label: 'Gerichtliche Wahrnehmung für Erbrecht', value: 'Wartezeit 12 Monate, bis zu 10.000 EUR' },
                        { label: 'Rechtsschutz für Betreuungs- und Vorsogeverfügungen', value: 'ohne Wartezeit, versichert auch anwaltliche Tätigkeiten über eine Beratung hinaus bis 1.000 EUR' }

                        ]

                    }
                ]
              },
              {
                title: 'Berufsrechtschutz',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Ar­beits­rechts­schutz', value: 'Wartezeit 3 Monate, Summe unbegrenzt Die Wartezeit entfällt bei einem lückenlosen Übergang von einem Vorversicherer. auch Aufhebungsvereinbarungen bis 5.000 EUR. Beratung bei arbeitsrechtlichen Angelegenheiten: je Beratung bis 250 EUR, max. 500 EUR je Kalenderjahr' },
                        { label: 'Ar­beits­rechts­schutz bei angedrohter Kündigung mit Versicherungsfall', value: 'Wartezeit 3 Monate, Summe unbegrenzt Die Wartezeit entfällt bei einem lückenlosen Übergang von einem Vorversicherer. auch Aufhebungsvereinbarungen bis 5.000 EUR. Beratung bei arbeitsrechtlichen Angelegenheiten: je Beratung bis 250 EUR, max. 500 EUR je Kalenderjahr' },
                        { label: 'Opferrechtsschutz', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenzt auch die Tätigkeit eines Rechtsanwaltes im Ermittlungs- und Nebenklageverfahren, sowie im Rahmen des Täter-Opferausgleiches, • auch Anti-Stalking Rechtsschutz; • auch außergerichtlich' },
                        { label: 'Rechts­schutz für Auf­he­bun­gs­ver­trä­ge', value: 'Wartezeit 3 Monate, Summe unbegrenzt Die Wartezeit entfällt bei einem lückenlosen Übergang von einem Vorversicherer. auch Aufhebungsvereinbarungen bis 5.000 EUR. Beratung bei arbeitsrechtlichen Angelegenheiten: je Beratung bis 250 EUR, max. 500 EUR je Kalenderjahr'}
                        ]
                    }
                ]
              },
              {
                title: 'Verkehrs-Rechtsschutz',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Ver­si­cher­te Fahr­zeu­ge', value: 'Alle auf den Versicherungsnehmer zugelassenen motorgetriebene Land-, Wasser- und Luftfahrzeuge sowie deren Anhänger Der Versicherungsschutz erstreckt sich auch auf die Wahrnehmung rechtlicher Interessen als Mieter oder Pächter von Garagen und Kraftfahrzeug-Abstellplätzen.' },
                        { label: 'Fahr­zeu­ge voll­jäh­ri­ger Kin­der', value: 'versichert (gemäß Familiendefinition)' },
                        { label: 'Ord­nun­gs­wid­rig­kei­ten-Rechts­schutz', value: 'gerichtlich und außergerichtlich, ohne Wartezeit, Summe unbegrenzt Auch Mitversicherung eines Firmen-Pkw' },
                        { label: 'Scha­denser­satz-Rechts­schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Rechts­schutz im Ver­trags- und Sach­recht', value: 'gerichtlich und außergerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Straf-Rechts­schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Steu­er-Rechts­schutz vor Ge­rich­ten', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenzt auch die Tätigkeit eines Rechtsanwaltes im Ermittlungs- und Nebenklageverfahren, sowie im Rahmen des Täter-Opferausgleiches auch außergerichtlich' },
                        { label: 'Ver­wal­tun­gs­rechts­schutz für Wi­der­spruchs­ver­fah­ren', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenz' },
                        { label: 'Ver­wal­tun­gs­rechts­schutz (ge­richt­lich)', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'So­zi­al­ge­richts­rechts­schutz für Wi­der­spruchs­ver­fah­ren', value: 'nicht versichert' },
                        { label: 'So­zi­al­ge­richts­rechts­schutz (ge­richt­lich)', value: 'ab vorgeschaltetem Widerspruchsverfahren, ohne Wartezeit, Summe unbegrenzt gerichtlich mitversichert' },
                        { label: 'Opferrechtsschutz', value: 'gerichtlich, ohne Wartezeit, Summe unbegrenzt auch die Tätigkeit eines Rechtsanwaltes im Ermittlungs- und Nebenklageverfahren, sowie im Rahmen des Täter-Opferausgleiches auch außergerichtlich' },
                        { label: 'Dis­zi­pli­nar- und Stan­des- Rechts­schutz', value: 'ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Ver­stoß gegen Halte- und Park­vor­schrif­ten', value: 'versichert Erst ab drohender Eintragung in das Fahreignungsregister (FAER)' },
                        { label: 'Ver­si­che­run­gs­schutz bei Ver­ur­tei­lung wegen vor­sätz­li­cher Straf­ta­ten im Ver­kehrs­be­reich', value: 'nicht versichert' }
                        ]
                    }
                ]
              },
              {
                title: 'Wohnen',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Ordnungswidrigkeiten-Rechts­schutz', value: 'gerichtlich und außergerichtlich, ohne Wartezeit, Summe unbegrenzt' },
                        { label: 'Verwaltungs-Rechts­schutz', value: 'gerichtlich, Wartezeit 3 Monate, Summe unbegrenzt Die Wartezeit entfällt bei einem lückenlosen Übergang von einem Vorversicherer' },
                        { label: 'Steuerrechtsschutz', value: 'ab vorgeschaltetem Widerspruchsverfahren, ohne Wartezeit, Summe unbegrenzt • gerichtlich mitversichert • Einspruchsverfahren mitversichert' },
                        { label: 'Strafrechtschutz', value: 'ohne Wartezeit, Summe unbegrenzt' }
                        ]
                    }
                ]
              },
              {
                title: 'Versicherte Kosten',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Freie Rechts­an­walts­wahl in Höhe der ge­setz­li­chen Ver­gü­tung', value: 'ja' },
                        { label: 'Kor­re­spon­denz­an­walt', value: 'bis zu 100 % d. Kosten Bei Rechtsschutzfällen im Inland: Alternativ werden die Reisekosten und Abwesenheitsgelder des zuständigen Anwalts übernommen.' },
                        { label: 'Kos­ten der Ge­gen­sei­te', value: 'bis zu 100 % d. Kosten' },
                        { label: 'Kosten und Gebühren für Zeugen und Sachverständige', value: 'bis zu 100 % d. Kosten' },
                        { label: 'Öf­fent­lich be­stell­te Sach­ver­stän­di­ge', value: 'bis zu 100 % d. Kosten' },
                        { label: 'Rei­se­kos­ten zum deut­schen Ge­richt', value: 'bis zu 100 % d. Kosten Sofern mehr als 100 km vom Gericht entfernt, alternativ die Kosten für einen Verkehrsanwalt' },
                        { label: 'Rei­se­kos­ten zum aus­län­di­schen Ge­richt', value: 'bis zu 100 % d. Kosten Sofern mehr als 100 km vom Gericht entfernt, alternativ die Kosten für einen Verkehrsanwalt' }
                        ]
                    }
                ]
              },
              {
                title: 'Spezial-Straf-Rechtsschutz',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Spe­zi­al-Straf-Rechts­schutz', value: 'bis zu 300.000 EUR' },
                        { label: 'De­ckun­gs­sum­me Spe­zi­al-Straf-Rechts­schutz', value: 'nicht versichert' },
                        { label: 'Straf­kau­ti­on', value: 'volle Kostenübernahme Kaution Weltweit bis zu einem Jahr Aufenthalt im Ausland bis 1.000.000 EUR. Auch erweiterte Strafkaution bis 300.000 EUR. Einschließlich Versicherungsschutz trotz Vorsatz bei Erledigung im Wege eines Strafbefehls' },
                        { label: 'Erweiterte Straf­kau­ti­on', value: 'bis zu 300.000 EUR' },
                        { label: 'Privater Bereich', value: 'bis zu 300.000 EUR' },
                        { label: 'Beschäftigung als Arbeitnehmer', value: 'bis zu 300.000 EUR' },
                        { label: 'Ehrenamt', value: 'nicht versichert' },
                        { label: 'Verdeckte Ermittlungen', value: 'nicht versichert' },
                        { label: 'Be­son­der­heit Spe­zi­al-Straf-Rechts­schutz', value: 'versichert Es wird eine angemessene Vergütung nach dem RVG z.B. für Reisekosten des Rechtsanwaltes; Nebenklagekosten und Sachverständigenkosten übernommen.' },
                        { label: 'Gegnerische Anwaltskosten im Falle des Unterliegens', value: 'bis zu 100 % d. Kosten' }
                        ]
                    }
                ]
              },
              {
                title: 'Beratungsdokumentation',
                subsections: [
                    {
                        title: '',
                        items: [
                        { label: 'Vertragslaufzeit', value: '12 Monate' },
                        { label: 'Kündigungsfrist', value: '1 Monat zum Ende' },
                        { label: 'Angebotsgültigkeit', value: '7 Tage' },
                        { label: 'Inklusivleistungen', value: 'Kostenlose Beratung' }
                        ]
                    }
                ]
              }
            ]
          }
        }
      ]
    };

    // ===== UTILITY FUNCTIONS =====
    function createStarsHTML(rating) {
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 !== 0;
      let html = '';
      for (let i = 0; i < fullStars; i++) {
        html += '<span class="star icn icn-star-filled" aria-hidden="true"></span>';
      }
      if (hasHalfStar) {
        html += '<span class="star icn icn-star-half-filled" aria-hidden="true"></span>';
      }
      return html;
    }

    function createDetailItemHTML(detail) {
      return `
        <div class="detail-item">
          <span class="detail-label">${detail.label}</span>
          <span class="detail-value">${detail.value}</span>
        </div>
      `;
    }

    function createFormFieldHTML(field) {
      const labelHTML = `
        <label for="${field.id}">
          <span class="label-text">${field.label}${field.required ? ' *' : ''}</span>
          <span class="info-icon icn icn-info-circle-filled" aria-hidden="true"></span>
        </label>
      `;
      if (field.type === 'select') {
        const optionsHTML = field.options
          .map(opt => `<option value="${opt.value}">${opt.label}</option>`)
          .join('');
        return `
          <div class="form-group">
            ${labelHTML}
            <ds-select id="${field.id}" ${field.required ? 'required' : ''}>
              ${optionsHTML}
            </ds-select>
          </div>
        `;
      } else if (field.type === 'input') {
        return `
          <div class="form-group">
            ${labelHTML}
            <ds-input
              id="${field.id}"
              type="${field.inputType || 'text'}"
              placeholder="${field.placeholder || ''}"
              ${field.step ? `step="${field.step}"` : ''}
              ${field.required ? 'required' : ''}
            ></ds-input>
          </div>
        `;
      }
    }

    // ===== STORAGE MANAGER =====
    class StorageManager {
      static saveFormData(data) {
        try {
          localStorage.setItem('verivox_checkout_data', JSON.stringify(data));
          console.log('✓ Form data saved to LocalStorage');
        } catch (e) {
          console.error('LocalStorage save error:', e);
        }
      }
      static loadFormData() {
        try {
          const data = localStorage.getItem('verivox_checkout_data');
          return data ? JSON.parse(data) : null;
        } catch (e) {
          console.error('LocalStorage load error:', e);
          return null;
        }
      }
      static saveCheckoutState(state) {
        try {
          localStorage.setItem('verivox_checkout_state', JSON.stringify(state));
          console.log('✓ Checkout state saved:', state);
        } catch (e) {
          console.error('LocalStorage state save error:', e);
        }
      }
      static loadCheckoutState() {
        try {
          const state = localStorage.getItem('verivox_checkout_state');
          return state ? JSON.parse(state) : null;
        } catch (e) {
          console.error('LocalStorage state load error:', e);
          return null;
        }
      }
      static clear() {
        try {
          localStorage.removeItem('verivox_checkout_data');
          localStorage.removeItem('verivox_checkout_state');
          console.log('✓ LocalStorage cleared');
          location.reload();
        } catch (e) {
          console.error('LocalStorage clear error:', e);
        }
      }
      static hasData() {
        return localStorage.getItem('verivox_checkout_data') !== null;
      }
    }

    // ===== STEPS MANAGER =====
    class StepsManager {
      constructor(config) {
        this.config = config;
        this.init();
      }
      init() {
        this.renderSteps();
        console.log(`✓ StepsManager initialized with ${this.config.length} steps`);
        this.setViewMode();
      }
      renderSteps() {
        const dsStepsElement = document.getElementById('checkoutSteps');
        dsStepsElement.innerHTML = '';
        const dsStepHide = document.createElement('DIV');
        dsStepHide.setAttribute('class', 'ds-steps');
        dsStepsElement.appendChild(dsStepHide);
        this.config.forEach(step => {
          const stepElement = document.createElement('ds-step');
          stepElement.setAttribute('heading', step.heading);
          stepElement.setAttribute('step-id', `step-${step.id}`);
          dsStepHide.appendChild(stepElement);
          dsStepHide.hidden = true;
        });
      }
      setViewMode() {
        const dsStepsElement = document.getElementById('checkoutSteps');
        const stepCount = this.config.length;
        console.log(`Total steps: ${stepCount}`);
        if (stepCount <= 5) {
          dsStepsElement.removeAttribute('view-mode');
          console.log('✓ View mode: Circle (default)');
        } else {
          dsStepsElement.setAttribute('view-mode', 'bar');
          console.log('✓ View mode: Bar');
        }
      }
    }

    // ===== CHECKOUT STEPS RENDERER =====
    class CheckoutStepsRenderer {
      constructor(config) {
        this.config = config;
        this.init();
      }
      init() {
        this.renderSteps();
        console.log(`✓ Rendered ${this.config.length} checkout step cards`);
      }
      renderSteps() {
        const container = document.getElementById('checkoutSteps-container');
        container.innerHTML = '';
        this.config.forEach(step => {
          const stepCard = this.createStepCard(step);
          container.appendChild(stepCard);
        });
      }
      createStepCard(step) {
        const card = document.createElement('div');
        card.className = 'step-card editing scroll-target';
        card.dataset.step = step.id;

        if (step.isConsentStep) {
          card.innerHTML = `
            <ds-ribbon variant="success" position="top-left">
              <span class="icn icn-check-circle-filled" aria-hidden="true"></span>
              Abgeschlossen
            </ds-ribbon>
            <div class="step-header">
              <div class="step-header-left">
                <div class="step-icon icn ${step.icon}" aria-hidden="true"></div>
                <div class="step-title">
                  <h2>${step.heading}</h2>
                  <span class="step-subtitle" id="subtitle-${step.id}"></span>
                </div>
              </div>
              <div class="step-header-right" id="header-action-${step.id}"></div>
            </div>
            <div class="step-content">
              <form class="step-form" id="form-${step.id}" novalidate>
                <div class="consent-section">
                  <div class="consent-checkbox-wrapper">
                    <ds-checkbox
                      id="newsletter-checkbox"
                      value="newsletter"
                      name="newsletter-consent"
                      aria-describedby="newsletter-text"
                    ></ds-checkbox>
                    <div class="consent-text" id="newsletter-text">
                        Ja, ich möchte kostenlos von Verivox über deren jeweilige <a class="inlinelink" href="https://www.verivox.de/company/verivox-gruppe/" target="_blank" data-auto-event-observed="true">Angebote</a> und im geringen Umfang auch über besondere Angebote ausgewählter Partner mittels personalisierter elektronischer Post (z.B. E-Mail, SMS, WhatsApp) informiert werden. Ich stimme der aggregierten Nutzungsanalyse (Öffnungen und Klicks) zu. Diese Einwilligung kann ich jederzeit mit Wirkung für die Zukunft widerrufen (E-Mail an service@verivox.de) ohne dass hierfür andere als Übermittlungskosten nach Basistarif entstehen. Weitere Infos hier: <a class="inlinelink" href="https://www.verivox.de/company/datenschutz/" target="_blank" data-auto-event-observed="true">Datenschutzhinweise</a>
                    </div>
                  </div>
                </div>
                <div class="disclaimer-text">
                    Mit Klick auf „KAUF ABSCHLIESSEN” erkläre ich mich mit den <a href="https://www.verivox.de/company/agb/" target="_blank">AGB</a> und der <a href="#" target="_blank">Beratungsdokumentation</a> der Verivox Versicherungsvergleich GmbH einverstanden und nehme die <a href="https://www.verivox.de/company/datenschutz-versicherungsvergleich/" target="_blank">Datenschutzerklärung</a> zur Kenntnis. Des Weiteren bestätige ich, die zu den <a href="#" target="_blank">Vertragsbedingungen des Versicherers</a> gehörigen Dokumente heruntergeladen zu haben und erkläre mich mit deren Inhalt einverstanden.
                </div>
                <div class="form-actions">
                  <ds-button text="Zurück" appearance="secondary" data-step="${step.id}" data-action="prev" class="btn-action" type="button"></ds-button>
                  <ds-button text="Kauf abschließen" appearance="primary" data-step="${step.id}" data-action="next" class="btn-action" type="button" icon-right="check-filled"></ds-button>
                </div>
              </form>
            </div>
            <div class="step-completed-content">
              <div class="completed-data">
                <div class="completed-data-row">
                  <div class="data-item">
                    <span class="data-label">Newsletter-Bestätigung</span>
                    <span class="data-value" id="completed-newsletter_consent">-</span>
                  </div>
                </div>
              </div>
            </div>
          `;
        } else {
          card.innerHTML = `
            <ds-ribbon variant="success" position="top-left">
              <span class="icn icn-check-circle-filled" aria-hidden="true"></span>
              Abgeschlossen
            </ds-ribbon>
            <div class="step-header">
              <div class="step-header-left">
                <div class="step-icon icn ${step.icon}" aria-hidden="true"></div>
                <div class="step-title">
                  <h2>${step.heading}</h2>
                  <span class="step-subtitle" id="subtitle-${step.id}"></span>
                </div>
              </div>
              <div class="step-header-right" id="header-action-${step.id}"></div>
            </div>
            <div class="step-content">
              <form class="step-form" id="form-${step.id}" novalidate>
                ${step.fields.map(field => createFormFieldHTML(field)).join('')}
                <div class="form-actions">
                  ${step.id > 1 ? `<ds-button text="Zurück" appearance="secondary" data-step="${step.id}" data-action="prev" class="btn-action" type="button"></ds-button>` : ''}
                  <ds-button text="${step.id === this.config.length ? 'Abschließen' : 'Weiter'}" appearance="primary" data-step="${step.id}" data-action="next" class="btn-action" type="button" ${step.id === this.config.length ? 'icon-right="check-filled"' : ''}></ds-button>
                </div>
              </form>
            </div>
            <div class="step-completed-content">
              <div class="completed-data">
                ${this.renderCompletedDataTemplate(step)}
              </div>
            </div>
          `;
        }
        return card;
      }
      renderCompletedDataTemplate(step) {
        const rows = [];
        const fields = step.completedDataFields;
        for (let i = 0; i < fields.length; i += 2) {
          let rowHTML = '<div class="completed-data-row">';
          const field1 = fields[i];
          rowHTML += `
            <div class="data-item">
              <span class="data-label">${field1.label}</span>
              <span class="data-value" id="completed-${field1.valueId || field1.valueIds?.[0] || ''}"></span>
            </div>
          `;
          if (fields[i + 1]) {
            const field2 = fields[i + 1];
            rowHTML += `
              <div class="data-item">
                <span class="data-label">${field2.label}</span>
                <span class="data-value" id="completed-${field2.valueId || field2.valueIds?.[0] || ''}"></span>
              </div>
            `;
          }
          rowHTML += '</div>';
          rows.push(rowHTML);
        }
        return rows.join('');
      }
    }

    // ===== PROVIDER BOX MANAGER =====
    class ProviderBoxManager {
      constructor(config, index) {
        this.config = config;
        this.index = index;
        this.boxId = config.id || `box-${index}`;
        this.init();
      }
      init() {
        this.renderBox();
        this.attachEventListeners();
        console.log(`✓ Provider Box "${this.config.name}" initialized`);
      }
      renderBox() {
        const wrapper = document.getElementById('providerBoxesWrapper');
        const boxHTML = `
          <div class="provider-box-item">
            <div class="provider-box">
                <div class="provider-offer">
                    <div class="provider-header">
                        <div class="provider-logo">
                            <img src="${this.config.logo}" alt="${this.config.name}" />
                        </div>
                        <div class="provider-info">
                            <div class="provider-name">${this.config.name}</div>
                            <div class="provider-rating">
                                <div class="stars">
                                    ${createStarsHTML(this.config.rating)}
                                </div>
                                <span>${this.config.rating}</span>
                            </div>
                        </div>
                    </div>
                    <div class="price-section">
                        <div class="price-value">
                            <div class="price-amount">
                                <span>${this.config.price.toFixed(2)}</span>
                                <span class="price-currency">€</span>
                            </div>
                        </div>
                    <div class="price-help">
                        <span>${this.config.pricePeriod}</span>
                        <span class="icn icn-info-circle-filled" aria-hidden="true"></span>
                    </div>
                </div>
              </div>
              <div class="details-section">
                ${this.config.details.map(detail => createDetailItemHTML(detail)).join('')}
              </div>
              <button type="button" class="action-link open-drawer-btn" data-box-id="${this.boxId}" aria-label="${this.config.actionLink.text} für ${this.config.name} anzeigen">
                <span class="icn ${this.config.actionLink.icon}" aria-hidden="true"></span>
                <span>${this.config.actionLink.text}</span>
              </button>
            </div>
          </div>
        `;
        wrapper.insertAdjacentHTML('beforeend', boxHTML);
      }
      attachEventListeners() {
        const btn = document.querySelector(`[data-box-id="${this.boxId}"]`);
        if (btn) {
          btn.addEventListener('click', (e) => {
            e.preventDefault();
            this.openDrawer();
          });
        }
      }
      openDrawer() {
        console.log(`Opening drawer for ${this.config.name}`);
        this.renderDrawer();
        const drawer = document.getElementById('tariffDrawer');
        const overlay = document.getElementById('drawerOverlay');
        drawer.classList.add('open');
        overlay.classList.add('open');
        document.body.style.overflow = 'hidden';
      }

      renderDrawer() {
        const drawerTitle = document.getElementById('drawerTitle');
        const drawerContent = document.getElementById('drawerContent');

        drawerTitle.textContent = this.config.drawerConfig.title;

        // ✅ ACCORDIONS MIT DS-ACCORDION-ITEM
        /*const sectionsHTML = `
          <ds-accordion>
            ${this.config.drawerConfig.sections
              .map((section) => {
                return `
                  <ds-accordion-item heading="${section.title}">
                    <div class="drawer-section-content">
                      ${section.items.map(item => `
                        <div class="drawer-list-item ${item.highlight ? 'highlight' : ''}">
                          <div class="drawer-item-label">${item.label}</div>
                          <div class="drawer-item-value">${item.value}</div>
                        </div>
                      `).join('')}
                    </div>
                  </ds-accordion-item>
                `;
              })
              .join('')}
          </ds-accordion>
        `;*/

        const sectionsHTML = `
          <ds-accordion>
            ${this.config.drawerConfig.sections
              .map((section) => {
                return `
                  <ds-accordion-item heading="${section.title}">
                    <div class="drawer-section-content">
			            ${section.subsections.map(subsections => `
				            <div class="drawer-subsection-item">

					            <div class="drawer-subsection-item-label">${subsections.title}</div>
                                    ${subsections.items.map(item => `
                                        <div class="drawer-list-item ${item.highlight ? 'highlight' : ''}">
                                            <div class="drawer-item-label">${item.label}</div>
                                            <div class="drawer-item-value">${item.value}</div>
                                        </div>
                                        `).join('')}
			                </div>
                        `).join('')}
                        </div>
                    </ds-accordion-item>
                    `;
                })
              .join('')}
          </ds-accordion>
        `;

        drawerContent.innerHTML = sectionsHTML;
      }
    }



    // ===== DRAWER MANAGER =====
    class DrawerManager {
      constructor() {
        this.drawer = document.getElementById('tariffDrawer');
        this.overlay = document.getElementById('drawerOverlay');
        this.closeBtn = document.getElementById('closeDrawer');
        this.init();
      }
      init() {
        this.closeBtn.addEventListener('click', () => this.close());
        this.overlay.addEventListener('click', () => this.close());
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') this.close();
        });
        console.log('✓ DrawerManager initialized');
      }
      close() {
        this.drawer.classList.remove('open');
        this.overlay.classList.remove('open');
        document.body.style.overflow = '';
        console.log('Drawer closed');
      }
    }

    // ===== CHECKOUT MANAGER =====
    class CheckoutManager {
      constructor(config) {
        this.config = config;
        this.currentStep = 1;
        this.formData = {};
        this.stepStartTime = Date.now();
        this.checkoutStartTime = Date.now();
        this.dsStepsElement = null;
        this.init();
      }
      init() {
        console.log('Initializing CheckoutManager');
        if (window.customElements) {
          customElements.whenDefined('ds-steps').then(() => {
            console.log('ds-steps loaded');
            this.dsStepsElement = document.getElementById('checkoutSteps');
            this.loadFromStorage();
            this.attachEventListeners();
            this.setupRealTimeValidation();
            this.updateProgressBar();
            this.updateStorageStatus();
            this.attachDsStepsEventListeners();
          });
        }
      }
      loadFromStorage() {
        const savedData = StorageManager.loadFormData();
        const savedState = StorageManager.loadCheckoutState();
        if (savedData) {
          this.formData = savedData;
          console.log('✓ Loaded form data from storage:', this.formData);
          Object.entries(savedData).forEach(([stepId, data]) => {
            Object.entries(data).forEach(([fieldId, value]) => {
              const field = document.getElementById(fieldId);
              if (field) {
                field.value = value;
              }
            });
          });
        }
        if (savedState) {
          this.currentStep = savedState.currentStep;
          this.dsStepsElement.current = this.currentStep;
          this.dsStepsElement.complete = savedState.completedSteps.length;
          savedState.completedSteps.forEach(step => {
            this.updateStepState(step, 'completed');
          });
          if (savedState.currentStep <= this.config.steps.length) {
            this.updateStepState(savedState.currentStep, 'editing');
          }
          console.log('✓ Loaded checkout state from storage');
        }
      }
      updateStorageStatus() {
        const hasData = StorageManager.hasData();
        const statusEl = document.getElementById('storage-status');
        if (statusEl) {
          statusEl.textContent = hasData ? 'Daten gespeichert' : 'Keine Daten';
        }
      }
      setupRealTimeValidation() {
        console.log('Setting up real-time validation');
        document.querySelectorAll('ds-input').forEach(input => {
          input.addEventListener('input', (e) => {
            this.validateField(input);
            this.autoSaveFormData();
          });
          input.addEventListener('change', (e) => {
            this.validateField(input);
            this.autoSaveFormData();
          });
        });
        document.querySelectorAll('ds-select').forEach(select => {
          select.addEventListener('change', (e) => {
            this.validateField(select);
            this.autoSaveFormData();
          });
        });
      }
      validateField(input) {
        const fieldId = input.id;
        const stepCard = input.closest('.step-card');
        if (!stepCard) return;
        const stepId = parseInt(stepCard.dataset.step);
        const stepConfig = this.config.steps.find(s => s.id === stepId);
        const fieldConfig = stepConfig.fields.find(f => f.id === fieldId);
        if (!fieldConfig || !fieldConfig.validation) return;
        const value = input.value;
        if (!value) {
          input.valid = false;
          input.invalid = false;
          input.errorMessage = '';
          return;
        }
        const isValid = fieldConfig.validation.validate(value);
        if (isValid) {
          input.valid = true;
          input.invalid = false;
          input.errorMessage = '';
        } else {
          input.valid = false;
          input.invalid = true;
          input.errorMessage = fieldConfig.validation.error;
        }
      }
      autoSaveFormData() {
        clearTimeout(this.saveTimeout);
        this.saveTimeout = setTimeout(() => {
          this.collectFormData(this.currentStep);
          StorageManager.saveFormData(this.formData);
          this.updateStorageStatus();
          console.log('✓ Auto-saved form data');
        }, 1000);
      }
      attachDsStepsEventListeners() {
        this.dsStepsElement.addEventListener('dsStepClick', (e) => {
          const stepNumber = e.detail;
          console.log('ds-step clicked:', stepNumber);
          if (this.currentStep !== stepNumber) {
            this.handleStepClick(stepNumber);
          }
        });
        this.dsStepsElement.addEventListener('dsNavigationClick', (e) => {
          const direction = e.detail;
          console.log('Navigation clicked:', direction);
          if (direction === 1) {
            this.handleNext(this.currentStep);
          } else if (direction === -1) {
            this.handlePrev(this.currentStep);
          }
        });
      }
      attachEventListeners() {
        console.log('Attaching event listeners');
        document.querySelectorAll('ds-button[data-action]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.preventDefault();
            const step = parseInt(btn.dataset.step);
            const action = btn.dataset.action;
            console.log(`Button clicked: step ${step}, action ${action}`);
            if (action === 'next') {
              this.handleNext(step);
            } else if (action === 'prev') {
              this.handlePrev(step);
            }
          });
        });
        document.getElementById('clear-storage').addEventListener('click', (e) => {
          e.preventDefault();
          if (confirm('Sollen alle gespeicherten Daten wirklich gelöscht werden?')) {
            StorageManager.clear();
          }
        });
      }
      attachChangeLinks() {
        document.querySelectorAll('.change-button-link').forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const step = parseInt(link.dataset.step);
            console.log(`Change link clicked: step ${step}`);
            this.handleEdit(step);
          });
        });
      }
      collectFormData(step) {
        const form = document.querySelector(`#form-${step}`);
        if (!form) return;
        const inputs = form.querySelectorAll('ds-input, ds-select');
        const data = {};
        inputs.forEach(input => {
          data[input.id] = input.value;
          console.log(`Collecting ${input.id}: ${input.value}`);
        });
        const checkbox = form.querySelector('ds-checkbox');
        if (checkbox) {
          data['newsletter_consent'] = checkbox.checked;
          console.log(`Collecting newsletter_consent: ${checkbox.checked}`);
        }
        if (!this.formData[step]) {
          this.formData[step] = {};
        }
        this.formData[step] = data;
        console.log('Form data collected:', this.formData[step]);
      }
      validateStep(step) {
        const form = document.querySelector(`#form-${step}`);
        if (!form) return false;
        const stepConfig = this.config.steps.find(s => s.id === step);
        if (stepConfig.isConsentStep) {
          const checkbox = form.querySelector('ds-checkbox');
          if (!checkbox || !checkbox.checked) {
            console.log('Bitte bestätigen Sie die Newsletter-Anmeldung, um den Kauf abzuschließen.');
            return false;
          }
          return true;
        }
        let isValid = true;
        form.querySelectorAll('ds-input[required], ds-select[required]').forEach(input => {
          const fieldId = input.id;
          const fieldConfig = stepConfig.fields.find(f => f.id === fieldId);
          if (!fieldConfig || !input.value || !fieldConfig.validation.validate(input.value)) {
            input.invalid = true;
            input.errorMessage = fieldConfig ? fieldConfig.validation.error : 'Dieses Feld ist erforderlich';
            isValid = false;
          } else {
            input.invalid = false;
          }
        });
        if (!isValid) {
            console.log('Bitte füllen Sie alle erforderlichen Felder korrekt aus.');
        }
        return isValid;
      }
      handleNext(step) {
        console.log(`handleNext: step ${step}`);
        this.collectFormData(step);
        if (!this.validateStep(step)) {
          console.log('Validation failed');
          return;
        }
        this.updateStepState(step, 'completed');
        if (step < this.config.steps.length) {
          this.currentStep = step + 1;
          this.dsStepsElement.current = this.currentStep;
          this.updateStepState(step + 1, 'editing');
          this.updateProgressBar();
          this.saveCheckoutState(this.getCompletedSteps());
          setTimeout(() => {
            document.querySelector(`[data-step="${step + 1}"]`).scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 300);
          this.stepStartTime = Date.now();
        } else {
          this.saveCheckoutState([...Array(this.config.steps.length).keys()].map(i => i + 1));
          this.completeCheckout();
        }
      }
      handlePrev(step) {
        console.log(`handlePrev: step ${step}`);
        this.currentStep = step;
        this.dsStepsElement.current = step;
        this.updateStepState(step, 'editing');
        if (step > 1) {
          this.updateStepState(step - 1, 'completed');
        }
        this.updateProgressBar();
        this.saveCheckoutState(this.getCompletedSteps());
        setTimeout(() => {
          document.querySelector(`[data-step="${step}"]`).scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 300);
        this.stepStartTime = Date.now();
      }
      handleEdit(step) {
        console.log(`handleEdit: step ${step}`);
        this.currentStep = step;
        this.dsStepsElement.current = step;
        this.updateStepState(step, 'editing');
        this.updateProgressBar();
        this.saveCheckoutState(this.getCompletedSteps());
        setTimeout(() => {
          document.querySelector(`[data-step="${step}"]`).scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 300);
        this.stepStartTime = Date.now();
      }
      getCompletedSteps() {
        const completedSteps = [];
        document.querySelectorAll('.step-card.completed').forEach(card => {
          completedSteps.push(parseInt(card.dataset.step));
        });
        return completedSteps;
      }
      saveCheckoutState(completedSteps) {
        StorageManager.saveCheckoutState({
          currentStep: this.currentStep,
          completedSteps: completedSteps
        });
      }
      updateStepState(step, state) {
        console.log(`updateStepState: step ${step}, state ${state}`);
        const card = document.querySelector(`[data-step="${step}"]`);
        const allCards = document.querySelectorAll('.step-card');
        allCards.forEach(c => {
          c.classList.remove('editing', 'completed', 'locked');
        });
        if (state === 'editing') {
          card.classList.add('editing');
          for (let i = 1; i < step; i++) {
            document.querySelector(`[data-step="${i}"]`).classList.add('completed');
          }
          for (let i = step + 1; i <= this.config.steps.length; i++) {
            document.querySelector(`[data-step="${i}"]`).classList.add('locked');
          }
        } else if (state === 'completed') {
          card.classList.add('completed');
          this.updateCompletedDisplay(step);
          for (let i = step + 1; i <= this.config.steps.length; i++) {
            document.querySelector(`[data-step="${i}"]`).classList.add('locked');
          }
        }
        this.attachChangeLinks();
      }
      updateProgressBar() {
        console.log('=== updateProgressBar called ===');
        const dsStepsElement = document.getElementById('checkoutSteps');
        if (dsStepsElement) {
          dsStepsElement.current = this.currentStep;
          console.log(`✓ Progress updated to step ${this.currentStep}`);
        }
      }
      updateCompletedDisplay(step) {
        console.log(`updateCompletedDisplay: step ${step}`);
        const stepConfig = this.config.steps.find(s => s.id === step);
        const data = this.formData[step] || {};
        const headerActionEl = document.getElementById(`header-action-${step}`);
        headerActionEl.innerHTML = `<button class="change-button-link icn-pencil-filled" data-step="${step}">Ändern</button>`;
        this.attachChangeLinks();
        if (stepConfig.isConsentStep) {
          const newsletterValue = data['newsletter_consent'] ? 'Ja' : 'Nein';
          const completedNewsletterEl = document.getElementById('completed-newsletter_consent');
          if (completedNewsletterEl) {
            completedNewsletterEl.textContent = newsletterValue;
          }
          return;
        }
        stepConfig.completedDataFields.forEach(field => {
          if (field.valueIds) {
            const values = field.valueIds.map(id => data[id]);
            const transformedValue = field.transform ? field.transform(values) : values.join(' ');
            const el = document.getElementById(`completed-${field.valueIds[0]}`);
            if (el) el.textContent = transformedValue;
          } else {
            let value = data[field.valueId] || '';
            if (field.transform) {
              value = field.transform(value);
            }
            const el = document.getElementById(`completed-${field.valueId}`);
            if (el) el.textContent = value;
          }
        });
        const subtitleEl = document.getElementById(`subtitle-${step}`);
        if (subtitleEl && stepConfig.completedDataFields[0]) {
          const firstField = stepConfig.completedDataFields[0];
          let value = data[firstField.valueId] || '';
          if (firstField.transform) {
            value = firstField.transform(value);
          }
          subtitleEl.textContent = value;
        }
      }
      completeCheckout() {
        console.log('Checkout completed');
        document.getElementById('checkoutSteps-container').style.display = 'none';
        const successMsg = document.getElementById('successMessage');
        successMsg.classList.add('show');
        console.log('Checkout completed with data:', this.formData);
        setTimeout(() => {
          alert('Vielen Dank für Ihren Checkout!\n\nDaten:\n' + JSON.stringify(this.formData, null, 2));
        }, 500);
      }
    }

    // ===== INITIALIZATION =====
    console.log('Page loaded, initializing...');
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        new StepsManager(CHECKOUT_CONFIG.steps);
        new CheckoutStepsRenderer(CHECKOUT_CONFIG.steps);
        new CheckoutManager(CHECKOUT_CONFIG);
        new DrawerManager();
        CHECKOUT_CONFIG.providers.forEach((config, index) => {
          new ProviderBoxManager(config, index);
        });
        console.log(`✓ ${CHECKOUT_CONFIG.providers.length} Provider Box(es) loaded`);
      });
    } else {
      new StepsManager(CHECKOUT_CONFIG.steps);
      new CheckoutStepsRenderer(CHECKOUT_CONFIG.steps);
      new CheckoutManager(CHECKOUT_CONFIG);
      new DrawerManager();
      CHECKOUT_CONFIG.providers.forEach((config, index) => {
        new ProviderBoxManager(config, index);
      });
      console.log(`✓ ${CHECKOUT_CONFIG.providers.length} Provider Box(es) loaded`);
    }
  </script>
</body>
</html>
